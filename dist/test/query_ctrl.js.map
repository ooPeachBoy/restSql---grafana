{"version":3,"sources":["../../src/query_ctrl.js"],"names":["GenericDatasourceQueryCtrl","$scope","$injector","uiSegmentSrv","$q","scope","lastQueryError","panelCtrl","events","on","PanelEvents","dataReceived","onDataReceived","bind","dataError","onDataError","render","onDataRefresh","console","log","joinQueryList","updateProjection","target","tableSelect","formats","text","value","types","type","tableSegment","newSegment","table","selectionsParts","selectionAdd","newPlusButton","selectMenu","push","whereParts","whereAdd","aggParts","aggAdd","groupParts","groupAdd","sortParts","sortAdd","fieldParts","fieldAdd","limitSegment","limit","queryLimitSegment","queryLimit","query","varables","datasource","templateSrv","variables","forEach","name","ele","current","key","includes","length","index","splice","sqlPart","create","part","Array","isArray","element","i","result","segments","_","map","results","segment","expandable","dataList","err","message","options","Promise","resolve","parts","indexOf","updateRestSql","parth","metricFindOption","then","status","data","tables","rows","joinIndex","getOptions","express","params","resetPlusButton","event","when","action","removePart","item","newOperators","expIndex","selections","param","operators","where","aggs","groups","onAdd","export","exportAdd","getExportOptions","getAllFields","button","plusButton","html","queryObj","mainFields","exportFields","concat","aggFunc","field","join","select","from","parseInt","fields","operatorToSuffix","suffix","filter","JSON","parse","startsWith","endsWith","tmpStr","slice","isNaN","parseFloat","Object","keys","toLowerCase","reject","aggregation","group_by","joinQuery","sortExp","sort","stringify","refresh","QueryCtrl","templateUrl"],"mappings":";;;;;;;;;;;;;AAAA;;AAEA;;;;AACA;;AACA;;;;AACA;;;;;;;;;;IAEaA,0B,WAAAA,0B;;;AAEX,sCAAYC,MAAZ,EAAoBC,SAApB,EAA+BC,YAA/B,EAA6CC,EAA7C,EAAiD;AAAA;;AAAA,wJACzCH,MADyC,EACjCC,SADiC;;AAE/C,UAAKG,KAAL,GAAaJ,MAAb;AACA,UAAKE,YAAL,GAAoBA,YAApB;AACA,UAAKC,EAAL,GAAUA,EAAV;AACA,UAAKE,cAAL,GAAsB,IAAtB;AACA,UAAKC,SAAL,CAAeC,MAAf,CAAsBC,EAAtB,CAAyBC,kBAAYC,YAArC,EAAmD,MAAKC,cAAL,CAAoBC,IAApB,OAAnD,EAAmFZ,MAAnF;AACA,UAAKM,SAAL,CAAeC,MAAf,CAAsBC,EAAtB,CAAyBC,kBAAYI,SAArC,EAAgD,MAAKC,WAAL,CAAiBF,IAAjB,OAAhD,EAA6EZ,MAA7E;;AAEA,UAAKM,SAAL,CAAeC,MAAf,CAAsBC,EAAtB,CAAyBC,kBAAYM,MAArC,EAA6C,MAAKC,aAAL,CAAmBJ,IAAnB,OAA7C,EAA4EZ,MAA5E;AACAiB,YAAQC,GAAR,QAAmB,sBAAnB;AACA,UAAKC,aAAL,GAAqB,MAAKA,aAAL,IAAsB,EAA3C;AACA,UAAKC,gBAAL;;AAEA,UAAKC,MAAL,CAAYC,WAAZ,GAA0B,MAAKD,MAAL,CAAYC,WAAZ,IAA2B,EAArD;;AAEA,UAAKC,OAAL,GAAe,CACb,EAAEC,MAAM,aAAR,EAAuBC,OAAO,mBAA9B,EADa,EAEb,EAAED,MAAM,OAAR,EAAiBC,OAAO,eAAxB,EAFa,CAAf;AAKA,UAAKC,KAAL,GAAa,CACX,EAAEF,MAAM,WAAR,EAAqBC,OAAO,WAA5B,EADW,EAEX,EAAED,MAAM,YAAR,EAAsBC,OAAO,YAA7B,EAFW,EAGX,EAAED,MAAM,WAAR,EAAqBC,OAAO,WAA5B,EAHW,CAAb;;AAOA;AACA,UAAKJ,MAAL,CAAYA,MAAZ,GAAqB,MAAKA,MAAL,CAAYA,MAAZ,IAAsB,EAA3C;AACA,UAAKA,MAAL,CAAYM,IAAZ,GAAmB,MAAKN,MAAL,CAAYM,IAAZ,IAAoB,mBAAvC;;AAEA,UAAKN,MAAL,CAAYO,YAAZ,GAA2B,MAAK1B,YAAL,CAAkB2B,UAAlB,CAA6B,EAAE,SAAS,MAAKR,MAAL,CAAYS,KAAZ,IAAqB,cAAhC,EAAgD,QAAQ,IAAxD,EAA7B,CAA3B;AACA,UAAKT,MAAL,CAAYS,KAAZ,GAAoB,MAAKT,MAAL,CAAYS,KAAZ,IAAqB,MAAKT,MAAL,CAAYO,YAAZ,CAAyBH,KAAlE;;AAEA,UAAKJ,MAAL,CAAYU,eAAZ,GAA8B,MAAKV,MAAL,CAAYU,eAAZ,IAA+B,EAA7D;AACA,UAAKC,YAAL,GAAoB,MAAK9B,YAAL,CAAkB+B,aAAlB,EAApB;;AAEA,UAAKC,UAAL,GAAkB,EAAlB;AACA,UAAKA,UAAL,CAAgBC,IAAhB,CAAqB,MAAKjC,YAAL,CAAkB2B,UAAlB,CAA6B,EAAEF,MAAM,YAAR,EAAsBF,OAAO,YAA7B,EAA7B,CAArB;AACA;AACA,UAAKJ,MAAL,CAAYe,UAAZ,GAAyB,MAAKf,MAAL,CAAYe,UAAZ,IAA0B,EAAnD;AACA,UAAKC,QAAL,GAAgB,MAAKnC,YAAL,CAAkB+B,aAAlB,EAAhB;AACA,UAAKZ,MAAL,CAAYiB,QAAZ,GAAuB,MAAKjB,MAAL,CAAYiB,QAAZ,IAAwB,EAA/C;AACA,UAAKC,MAAL,GAAc,MAAKrC,YAAL,CAAkB+B,aAAlB,EAAd;AACA,UAAKZ,MAAL,CAAYmB,UAAZ,GAAyB,MAAKnB,MAAL,CAAYmB,UAAZ,IAA0B,EAAnD;AACA,UAAKC,QAAL,GAAgB,MAAKvC,YAAL,CAAkB+B,aAAlB,EAAhB;AACA,UAAKZ,MAAL,CAAYF,aAAZ,GAA4B,MAAKE,MAAL,CAAYF,aAAZ,IAA2B,EAAvD;;AAEA,UAAKE,MAAL,CAAYqB,SAAZ,GAAwB,MAAKrB,MAAL,CAAYqB,SAAZ,IAAyB,EAAjD;AACA,UAAKC,OAAL,GAAe,MAAKzC,YAAL,CAAkB+B,aAAlB,EAAf;AACA,UAAKZ,MAAL,CAAYuB,UAAZ,GAAyB,MAAKvB,MAAL,CAAYuB,UAAZ,IAA0B,EAAnD;AACA,UAAKC,QAAL,GAAgB,MAAK3C,YAAL,CAAkB+B,aAAlB,EAAhB;;AAEA,UAAKZ,MAAL,CAAYyB,YAAZ,GAA2B,MAAK5C,YAAL,CAAkB2B,UAAlB,CAA6B,EAAE,SAAS,MAAKR,MAAL,CAAY0B,KAAZ,IAAqB,MAAhC,EAAwC,QAAQ,IAAhD,EAA7B,CAA3B;AACA,UAAK1B,MAAL,CAAY0B,KAAZ,GAAoB,MAAK1B,MAAL,CAAYyB,YAAZ,CAAyBrB,KAAzB,IAAkC,MAAtD;AACA,UAAKJ,MAAL,CAAY2B,iBAAZ,GAAgC,MAAK9C,YAAL,CAAkB2B,UAAlB,CAA6B,EAAE,SAAS,MAAKR,MAAL,CAAY4B,UAAZ,IAA0B,MAArC,EAA6C,QAAQ,IAArD,EAA7B,CAAhC;AACA,UAAK5B,MAAL,CAAY4B,UAAZ,GAAyB,MAAK5B,MAAL,CAAY2B,iBAAZ,CAA8BvB,KAA9B,IAAuC,MAAhE;AACA,UAAKJ,MAAL,CAAY6B,KAAZ,GAAoB,MAAK7B,MAAL,CAAY6B,KAAZ,IAAoB;AACtC;AACA,gBAAU;AACR,gBAAQ,EADA;AAER,kBAAU,EAFF;AAGR,oBAAY,EAHJ;AAIR,uBAAe,EAJP;AAKR,gBAAQ;AALA,OAF4B;AAStC,cAAQ,EAT8B;AAUtC,cAAQ,EAV8B;AAWtC,gBAAU,EAX4B;AAYtC,eAAS;AAZ6B,KAAxC;;AAeA,UAAKC,QAAL,GAAgB,MAAKA,QAAL,IAAgB,EAAhC;AACA,UAAK7C,SAAL,CAAe8C,UAAf,CAA0BC,WAA1B,CAAsCC,SAAtC,CAAgDC,OAAhD,CAAwD,eAAO;AAC7D;AACA,YAAKJ,QAAL,CAAchB,IAAd,CAAmB;AACjBqB,cAAK,MAAKC,IAAID,IADG;AAEjB/B,eAAOgC,IAAIC,OAAJ,CAAYjC;AAFF,OAAnB;AAID,KAND;AA1E+C;AAiFhD;;;;uCACkB;AAAA;;AACjB,UAAI,KAAKJ,MAAL,CAAYA,MAAhB,EAAyB;AAAA,mCACZsC,GADY;AAErB,cAAIA,IAAIC,QAAJ,CAAa,OAAb,KAAuB,OAAKvC,MAAL,CAAYsC,GAAZ,EAAiBE,MAAjB,GAAwB,CAAnD,EAAsD;AACpD,mBAAKxC,MAAL,CAAYsC,GAAZ,EAAiBJ,OAAjB,CAAyB,UAACE,GAAD,EAAMK,KAAN,EAAgB;AACvC,qBAAKzC,MAAL,CAAYsC,GAAZ,EAAiBI,MAAjB,CAAwBD,KAAxB,EAA8B,CAA9B,EAAgCE,mBAAQC,MAAR,CAAeR,IAAIS,IAAnB,CAAhC;AACD,aAFD;AAGD,WAJD,MAIO,IAAIP,IAAIC,QAAJ,CAAa,SAAb,CAAJ,EAA6B;AAChC,mBAAKvC,MAAL,CAAYsC,GAAZ,IAAmB,OAAKzD,YAAL,CAAkB2B,UAAlB,CAA6B,EAAE,SAAS,OAAKR,MAAL,CAAYsC,GAAZ,EAAiBlC,KAA5B,EAAkC,QAAO,IAAzC,EAA7B,CAAnB;AACH,WAFM,MAEA;AACL,mBAAKJ,MAAL,CAAYM,IAAZ,GAAmB,OAAKN,MAAL,CAAYM,IAA/B;AACD;AAVoB;;AACvB,aAAK,IAAMgC,GAAX,IAAkB,KAAKtC,MAAvB,EAA+B;AAAA,gBAApBsC,GAAoB;AAU9B;AACD,YAAI,KAAKtC,MAAL,CAAYF,aAAZ,CAA0B0C,MAA1B,GAAmC,CAAvC,EAA0C;AACxC,eAAKxC,MAAL,CAAYF,aAAZ,CAA0BoC,OAA1B,CAAkC,UAACE,GAAD,EAAMK,KAAN,EAAgB;AAAA,yCACrCH,GADqC;AAE9C,kBAAIQ,MAAMC,OAAN,CAAcX,IAAIE,GAAJ,KAAYF,IAAIE,GAAJ,EAASE,MAAT,GAAkB,CAA5C,CAAJ,EAAoD;AAClDJ,oBAAIE,GAAJ,EAASJ,OAAT,CAAiB,UAACc,OAAD,EAAUC,CAAV,EAAgB;AAC/Bb,sBAAIE,GAAJ,EAASI,MAAT,CAAgBO,CAAhB,EAAmB,CAAnB,EAAsBN,mBAAQC,MAAR,CAAeI,QAAQH,IAAvB,CAAtB;AACD,iBAFD;AAGD,eAJD,MAIO,IAAIP,IAAIC,QAAJ,CAAa,KAAb,CAAJ,EAAyB;AAC9BH,oBAAIE,GAAJ,IAAW,OAAKzD,YAAL,CAAkB+B,aAAlB,EAAX;AACD,eAFM,MAEA,IAAI0B,OAAO,MAAX,EAAmB;AACxBF,oBAAIE,GAAJ,IAAWF,IAAI9B,IAAf;AACD,eAFM,MAEA,IAAIgC,OAAO,OAAP,IAAgBA,OAAK,OAAzB,EAAkC;AACvCF,oBAAIE,GAAJ,IAAW,OAAKzD,YAAL,CAAkB2B,UAAlB,CAA6B,EAAE,SAAS4B,IAAIE,GAAJ,EAASlC,KAApB,EAA2B,QAAQ,IAAnC,EAA7B,CAAX;AACD;AAZ6C;;AAChD,iBAAK,IAAMkC,GAAX,IAAkBF,GAAlB,EAAuB;AAAA,qBAAZE,GAAY;AAYtB;AACF,WAdD;AAeD;AACF;AAGF;;;oCACe;AACd;AACD;;;0CAEqB;AAAA;;AACpB,aAAO,UAACY,MAAD,EAAY;AACjB,YAAMC,WAAWC,iBAAEC,GAAF,CAAMC,OAAN,EAAe,mBAAW;AACzC,iBAAO,OAAKzE,YAAL,CAAkB2B,UAAlB,CAA6B;AAClCJ,mBAAOmD,QAAQpD,IADmB;AAElCqD,wBAAYD,QAAQC;AAFc,WAA7B,CAAP;AAID,SALgB,CAAjB;AAMA,eAAOL,QAAP;AACD,OARD;AASD;;;mCAEcM,Q,EAAU;AACvB7D,cAAQC,GAAR,CAAY4D,QAAZ;AACA,WAAKzE,cAAL,GAAsB,IAAtB;AACD;;;gCACW0E,G,EAAK;AACf,UAAI,KAAK1D,MAAL,CAAYA,MAAhB,EAAwB;AACtB,aAAKhB,cAAL,GAAsB0E,IAAIC,OAA1B;AACD;AAEF;;;iCAEY;AACX,UAAMC,UAAU,EAAhB;AACAA,cAAQ9C,IAAR,CAAa,KAAKjC,YAAL,CAAkB2B,UAAlB,CAA6B,EAAEF,MAAM,YAAR,EAAsBF,OAAO,YAA7B,EAA7B,CAAb;AACAR,cAAQC,GAAR,CAAY,mBAAZ,EAAiC+D,OAAjC;AACA,aAAOC,QAAQC,OAAR,CAAgBF,OAAhB,CAAP;AACD;;;+BAEUG,K,EAAOlB,I,EAAM;AACtB,UAAMJ,QAAQW,iBAAEY,OAAF,CAAUD,KAAV,EAAiBlB,IAAjB,CAAd;AACAkB,YAAMrB,MAAN,CAAaD,KAAb,EAAoB,CAApB;AACD;;;sCAEiB;AAChB;AACA,WAAKwB,aAAL;AACD;;;uCACkB;AACjBrE,cAAQC,GAAR,CAAY,MAAZ;AACA,WAAKoE,aAAL;AACD;;;qCAEgB;AAAA;;AACfrE,cAAQC,GAAR,CAAY,cAAZ,EAA4B,IAA5B,EAAkC,KAAKG,MAAL,CAAYO,YAAZ,CAAyBH,KAA3D;AACA,WAAKJ,MAAL,CAAYS,KAAZ,GAAoB,KAAKT,MAAL,CAAYO,YAAZ,CAAyBH,KAA7C;AACA,UAAI8D,QAAQ,SAAZ;AACA,WAAKnC,UAAL,CAAgBoC,gBAAhB,CAAiC,KAAKnE,MAAL,CAAYS,KAA7C,EAAoDyD,KAApD,EAA2DE,IAA3D,CAAgE,kBAAU;AACxE,YAAIlB,OAAOmB,MAAP,KAAkB,GAAtB,EAA2B;AACzB,iBAAKrE,MAAL,CAAYC,WAAZ,GAA0BiD,OAAOoB,IAAP,CAAYA,IAAZ,CAAiBC,MAAjB,CAAwB,CAAxB,EAA2BC,IAArD;AACD;AACF,OAJD;AAKA,WAAKP,aAAL;AACD;;;uCAEkBQ,S,EAAW;AAC5B7E,cAAQC,GAAR,CAAY,oBAAZ,EAAkC4E,SAAlC;AACA;AACA,WAAKR,aAAL;AACD;;;qCAEgB;AACf;AACA,WAAKjE,MAAL,CAAY0B,KAAZ,GAAoB,KAAK1B,MAAL,CAAYyB,YAAZ,CAAyBrB,KAA7C;AACA,WAAK6D,aAAL;AACD;;;0CACqB;AACpB,WAAKjE,MAAL,CAAY4B,UAAZ,GAAyB,KAAK5B,MAAL,CAAY2B,iBAAZ,CAA8BvB,KAAvD;AACA,WAAK6D,aAAL;AACD;;;uCACkBQ,S,EAAW;AAC5B,WAAKzE,MAAL,CAAYF,aAAZ,CAA0B2E,SAA1B,EAAqC/C,KAArC,GAA6C,KAAK7C,YAAL,CAAkB2B,UAAlB,CAA6B,EAAE,SAAS,KAAKR,MAAL,CAAYF,aAAZ,CAA0B2E,SAA1B,EAAqC/C,KAArC,CAA2CtB,KAA3C,IAAoD,MAA/D,EAAuE,QAAQ,IAA/E,EAA7B,CAA7C;AACA,WAAK6D,aAAL;AACD;;;uCAEkBpB,I,EAAMJ,K,EAAO;AAC9B7C,cAAQC,GAAR,CAAY,IAAZ,EAAkBgD,IAAlB,EAAwBJ,KAAxB;AACA,WAAKiC,UAAL;AACA,UAAMC,UAAUhC,mBAAQC,MAAR,CAAe,EAAEtC,MAAM,QAAR,EAAkBsE,QAAQ,CAAC,QAAD,CAA1B,EAAf,CAAhB;AACA,WAAK5E,MAAL,CAAYU,eAAZ,CAA4BI,IAA5B,CAAiC6D,OAAjC;AACA,WAAKE,eAAL,CAAqB,KAAKlE,YAA1B;AACD;;;8CAEyBkC,I,EAAMJ,K,EAAOqC,K,EAAO;AAC5ClF,cAAQC,GAAR,CAAY,kCAAZ,EAAgDiF,KAAhD,EAAuDrC,KAAvD,EAA8DI,IAA9D,EAAoE,KAApE;AACA;AACA,UAAIiC,MAAM3C,IAAN,KAAe,kBAAnB,EAAuC;AACrC,eAAO,KAAKrD,EAAL,CAAQiG,IAAR,CAAa,CAAC,EAAE5E,MAAM,QAAR,EAAkBC,OAAO,QAAzB,EAAD,CAAb,CAAP;AAED,OAHD,MAGO,IAAI0E,MAAM3C,IAAN,KAAe,QAAf,IAA2B2C,MAAME,MAAN,CAAa5E,KAAb,KAAuB,QAAtD,EAAgE;AACrE,aAAK6E,UAAL,CAAgB,KAAKjF,MAAL,CAAYU,eAA5B,EAA6CmC,IAA7C;AACA;AACA,aAAKoB,aAAL;AACArE,gBAAQC,GAAR,CAAY,KAAKG,MAAL,CAAYU,eAAxB,EAAyC,QAAzC;AACD,OALM,MAKA,IAAIoE,MAAM3C,IAAN,KAAe,oBAAnB,EAAyC;AAC9C;AACA,aAAKnC,MAAL,CAAYU,eAAZ,CAA4BwB,OAA5B,CAAoC,UAACgD,IAAD,EAAOjC,CAAP,EAAa,CAChD,CADD;AAEA,aAAKgB,aAAL;AACD,OALM,MAKA,IAAIa,MAAM3C,IAAN,KAAe,mBAAnB,EAAwC;AAC7C,eAAO0B,QAAQC,OAAR,CAAgB,KAAKjF,YAAL,CAAkBsG,YAAlB,CAA+B,KAAKnF,MAAL,CAAYC,WAA3C,CAAhB,CAAP;AACD;AACF;;;2CAEsBwE,S,EAAWW,Q,EAAU;AAC1CxF,cAAQC,GAAR,CAAY,wBAAZ,EAAsC4E,SAAtC,EAAiDW,QAAjD;AACA,UAAMT,UAAUhC,mBAAQC,MAAR,CAAe,EAAEtC,MAAM,QAAR,EAAkBsE,QAAQ,CAAC,QAAD,CAA1B,EAAf,CAAhB;AACA,WAAK5E,MAAL,CAAYF,aAAZ,CAA0B2E,SAA1B,EAAqCY,UAArC,CAAgDvE,IAAhD,CAAqD6D,OAArD;AACA,WAAKE,eAAL,CAAqB,KAAK7E,MAAL,CAAYF,aAAZ,CAA0B2E,SAA1B,EAAqC9D,YAA1D;AACD;;;kDAE6BkC,I,EAAM4B,S,EAAWW,Q,EAAUN,K,EAAO;AAC9DlF,cAAQC,GAAR,CAAY,+BAAZ,EAA6C4E,SAA7C,EAAwDW,QAAxD;AACA,UAAIN,MAAM3C,IAAN,KAAe,kBAAnB,EAAuC;AACrC,eAAO,KAAKrD,EAAL,CAAQiG,IAAR,CAAa,CAAC,EAAE5E,MAAM,QAAR,EAAkBC,OAAO,QAAzB,EAAD,CAAb,CAAP;AACD,OAFD,MAEO,IAAI0E,MAAM3C,IAAN,KAAe,QAAf,IAA2B2C,MAAME,MAAN,CAAa5E,KAAb,KAAuB,QAAtD,EAAgE;AACrE;AACA,aAAKJ,MAAL,CAAYF,aAAZ,CAA0B2E,SAA1B,EAAqCY,UAArC,CAAgD3C,MAAhD,CAAuD0C,QAAvD,EAAiE,CAAjE;AACA,aAAKnB,aAAL;AACD,OAJM,MAIA,IAAIa,MAAM3C,IAAN,KAAe,oBAAnB,EAAyC;AAC9C,aAAK8B,aAAL;AACD;AACF;;;mCAEcpB,I,EAAMJ,K,EAAO;AAC1B,UAAMkC,UAAUhC,mBAAQC,MAAR,CAAe,EAAEtC,MAAM,YAAR,EAAsBsE,QAAQ,CAAC,QAAD,EAAW,GAAX,EAAgB,OAAhB,CAA9B,EAAf,CAAhB;;AAEA,WAAK5E,MAAL,CAAYe,UAAZ,CAAuBD,IAAvB,CAA4B6D,OAA5B;AACA,WAAKE,eAAL,CAAqB,KAAK7D,QAA1B;AACD;;;yCAGoB6B,I,EAAMJ,K,EAAOqC,K,EAAO;AACvC;AACA,UAAIA,MAAM3C,IAAN,KAAe,mBAAf,IAAsC2C,MAAMQ,KAAN,CAAYnD,IAAZ,KAAqB,IAA/D,EAAqE;AACnE;AACA,YAAMoD,YAAY,CAAC,GAAD,EAAM,GAAN,EAAW,IAAX,EAAiB,GAAjB,EAAsB,IAAtB,EAA4B,UAA5B,EAAwC,YAAxC,EAAsD,UAAtD,EAAkE,OAAlE,EAA2E,IAA3E,CAAlB;AACA,eAAO1B,QAAQC,OAAR,CAAgB,KAAKjF,YAAL,CAAkBsG,YAAlB,CAA+BI,SAA/B,CAAhB,CAAP;AACD,OAJD,MAIO,IAAIT,MAAM3C,IAAN,KAAe,kBAAnB,EAAuC;AAC5C,eAAO,KAAKrD,EAAL,CAAQiG,IAAR,CAAa,CAAC,EAAE5E,MAAM,QAAR,EAAkBC,OAAO,QAAzB,EAAD,CAAb,CAAP;AACD,OAFM,MAEA,IAAI0E,MAAM3C,IAAN,KAAe,QAAf,IAA2B2C,MAAME,MAAN,CAAa5E,KAAb,KAAuB,QAAtD,EAAgE;AACrE,aAAKJ,MAAL,CAAYe,UAAZ,CAAuB2B,MAAvB,CAA8BD,KAA9B,EAAqC,CAArC;AACA,aAAKwB,aAAL;AACD,OAHM,MAGA,IAAIa,MAAM3C,IAAN,KAAe,oBAAnB,EAAyC;AAC9CvC,gBAAQC,GAAR,CAAYgD,IAAZ,EAAiBJ,KAAjB,EAAuB,IAAvB;AACA,aAAKwB,aAAL;AACD,OAHM,MAGA;AACL,eAAOJ,QAAQC,OAAR,CAAgB,EAAhB,CAAP;AACD;AACF;;;uCAEkBW,S,EAAWW,Q,EAAU;AACtC,UAAMT,UAAUhC,mBAAQC,MAAR,CAAe,EAAEtC,MAAM,YAAR,EAAsBsE,QAAQ,CAAC,QAAD,EAAW,GAAX,EAAgB,OAAhB,CAA9B,EAAf,CAAhB;AACAhF,cAAQC,GAAR,CAAY,gBAAZ,EAA8B8E,OAA9B;AACA,WAAK3E,MAAL,CAAYF,aAAZ,CAA0B2E,SAA1B,EAAqCe,KAArC,CAA2C1E,IAA3C,CAAgD6D,OAAhD;AACA,WAAKE,eAAL,CAAqB,KAAK7E,MAAL,CAAYF,aAAZ,CAA0B2E,SAA1B,EAAqCzD,QAA1D;AACD;;;6CAEwB6B,I,EAAM4B,S,EAAWW,Q,EAAUN,K,EAAO;AACzDlF,cAAQC,GAAR,CAAY,0BAAZ,EAAwCiF,KAAxC;AACA,UAAIA,MAAM3C,IAAN,KAAe,mBAAf,IAAsC2C,MAAMQ,KAAN,CAAYnD,IAAZ,KAAqB,IAA/D,EAAqE;AACnE;AACA,YAAMoD,YAAY,CAAC,GAAD,EAAM,GAAN,EAAW,IAAX,EAAiB,GAAjB,EAAsB,IAAtB,EAA4B,UAA5B,EAAwC,YAAxC,EAAsD,UAAtD,EAAkE,OAAlE,EAA2E,IAA3E,CAAlB;AACA,eAAO1B,QAAQC,OAAR,CAAgB,KAAKjF,YAAL,CAAkBsG,YAAlB,CAA+BI,SAA/B,CAAhB,CAAP;AACD,OAJD,MAIO,IAAIT,MAAM3C,IAAN,KAAe,kBAAnB,EAAuC;AAC5C,eAAO,KAAKrD,EAAL,CAAQiG,IAAR,CAAa,CAAC,EAAE5E,MAAM,QAAR,EAAkBC,OAAO,QAAzB,EAAD,CAAb,CAAP;AACD,OAFM,MAEA,IAAI0E,MAAM3C,IAAN,KAAe,QAAf,IAA2B2C,MAAME,MAAN,CAAa5E,KAAb,KAAuB,QAAtD,EAAgE;AACrE,aAAKJ,MAAL,CAAYF,aAAZ,CAA0B2E,SAA1B,EAAqCe,KAArC,CAA2C9C,MAA3C,CAAkD0C,QAAlD,EAA4D,CAA5D;AACD,OAFM,MAEA,IAAIN,MAAM3C,IAAN,KAAe,oBAAnB,EAAyC;AAC9C,aAAK8B,aAAL;AACD,OAFM,MAEA;AACL,eAAOJ,QAAQC,OAAR,CAAgB,EAAhB,CAAP;AACD;AACF;;;mCAEc;AACb,UAAMa,UAAUhC,mBAAQC,MAAR,CAAe,EAAEtC,MAAM,WAAR,EAAqBsE,QAAQ,CAAC,KAAD,EAAQ,QAAR,CAA7B,EAAf,CAAhB;AACAhF,cAAQC,GAAR,CAAY,cAAZ,EAA4B8E,OAA5B;AACA,WAAK3E,MAAL,CAAYiB,QAAZ,CAAqBH,IAArB,CAA0B6D,OAA1B;AACA,WAAKE,eAAL,CAAqB,KAAK3D,MAA1B;AACD;;;uCAEkB2B,I,EAAMJ,K,EAAOqC,K,EAAO;AACrClF,cAAQC,GAAR,CAAY,oBAAZ,EAAkCiF,KAAlC,EAAyCjC,IAAzC,EAA+CJ,KAA/C;AACA,UAAIqC,MAAM3C,IAAN,KAAe,mBAAf,IAAsC2C,MAAMQ,KAAN,CAAYnD,IAAZ,KAAqB,KAA/D,EAAsE;AACpE;AACA,YAAMoD,YAAYT,MAAMQ,KAAN,CAAY1B,OAA9B;AACA,eAAOC,QAAQC,OAAR,CAAgB,KAAKjF,YAAL,CAAkBsG,YAAlB,CAA+BI,SAA/B,CAAhB,CAAP;AACD,OAJD,MAIO,IAAIT,MAAM3C,IAAN,KAAe,kBAAnB,EAAuC;AAC5C,eAAO,KAAKrD,EAAL,CAAQiG,IAAR,CAAa,CAAC,EAAE5E,MAAM,QAAR,EAAkBC,OAAO,QAAzB,EAAD,CAAb,CAAP;AACD,OAFM,MAEA,IAAI0E,MAAM3C,IAAN,KAAe,QAAf,IAA2B2C,MAAME,MAAN,CAAa5E,KAAb,KAAuB,QAAtD,EAAgE;AACrE,aAAKJ,MAAL,CAAYiB,QAAZ,CAAqByB,MAArB,CAA4BD,KAA5B,EAAmC,CAAnC;AACA,aAAKwB,aAAL;AACD,OAHM,MAGA,IAAIa,MAAM3C,IAAN,KAAe,oBAAnB,EAAyC;AAC9C,aAAK8B,aAAL;AACD,OAFM,MAEA;AACL,eAAOJ,QAAQC,OAAR,CAAgB,EAAhB,CAAP;AACD;AACF;;;qCAEgBW,S,EAAW;AAC1B,UAAME,UAAUhC,mBAAQC,MAAR,CAAe,EAAEtC,MAAM,WAAR,EAAqBsE,QAAQ,CAAC,KAAD,EAAQ,QAAR,CAA7B,EAAf,CAAhB;AACAhF,cAAQC,GAAR,CAAY,kBAAZ,EAAgC8E,OAAhC;AACA,WAAK3E,MAAL,CAAYF,aAAZ,CAA0B2E,SAA1B,EAAqCgB,IAArC,CAA0C3E,IAA1C,CAA+C6D,OAA/C;AACA,WAAKE,eAAL,CAAqB,KAAK7E,MAAL,CAAYF,aAAZ,CAA0B2E,SAA1B,EAAqCvD,MAA1D;AACD;;;2CAEsB2B,I,EAAM4B,S,EAAWW,Q,EAAUN,K,EAAO;AACvDlF,cAAQC,GAAR,CAAY,wBAAZ,EAAsCiF,KAAtC;AACA,UAAIA,MAAM3C,IAAN,KAAe,mBAAf,IAAsC2C,MAAMQ,KAAN,CAAYnD,IAAZ,KAAqB,KAA/D,EAAsE;AACpE;AACA,YAAMoD,YAAYT,MAAMQ,KAAN,CAAY1B,OAA9B;AACA,eAAOC,QAAQC,OAAR,CAAgB,KAAKjF,YAAL,CAAkBsG,YAAlB,CAA+BI,SAA/B,CAAhB,CAAP;AACD,OAJD,MAIO,IAAIT,MAAM3C,IAAN,KAAe,kBAAnB,EAAuC;AAC5C,eAAO,KAAKrD,EAAL,CAAQiG,IAAR,CAAa,CAAC,EAAE5E,MAAM,QAAR,EAAkBC,OAAO,QAAzB,EAAD,CAAb,CAAP;AACD,OAFM,MAEA,IAAI0E,MAAM3C,IAAN,KAAe,QAAf,IAA2B2C,MAAME,MAAN,CAAa5E,KAAb,KAAuB,QAAtD,EAAgE;AACrE,aAAKJ,MAAL,CAAYF,aAAZ,CAA0B2E,SAA1B,EAAqCgB,IAArC,CAA0C/C,MAA1C,CAAiD0C,QAAjD,EAA2D,CAA3D;AACA,aAAKnB,aAAL;AACD,OAHM,MAGA,IAAIa,MAAM3C,IAAN,KAAe,oBAAnB,EAAyC;AAC9C,aAAK8B,aAAL;AACD,OAFM,MAEA;AACL,eAAOJ,QAAQC,OAAR,CAAgB,EAAhB,CAAP;AACD;AACF;;;qCAEgB;AACf,UAAMa,UAAUhC,mBAAQC,MAAR,CAAe,EAAEtC,MAAM,QAAR,EAAkBsE,QAAQ,CAAC,QAAD,CAA1B,EAAf,CAAhB;AACAhF,cAAQC,GAAR,CAAY,iBAAZ,EAA+B8E,OAA/B;AACA,WAAK3E,MAAL,CAAYmB,UAAZ,CAAuBL,IAAvB,CAA4B6D,OAA5B;AACA,WAAKE,eAAL,CAAqB,KAAKzD,QAA1B;AACD;;;yCAEoByB,I,EAAMJ,K,EAAOqC,K,EAAO;AACvClF,cAAQC,GAAR,CAAY,uBAAZ;AACA,UAAIiF,MAAM3C,IAAN,KAAe,kBAAnB,EAAuC;AACrC,eAAO,KAAKrD,EAAL,CAAQiG,IAAR,CAAa,CAAC,EAAE5E,MAAM,QAAR,EAAkBC,OAAO,QAAzB,EAAD,CAAb,CAAP;AACD,OAFD,MAEO,IAAI0E,MAAM3C,IAAN,KAAe,QAAf,IAA2B2C,MAAME,MAAN,CAAa5E,KAAb,KAAuB,QAAtD,EAAgE;AACrE,aAAKJ,MAAL,CAAYmB,UAAZ,CAAuBuB,MAAvB,CAA8BD,KAA9B,EAAqC,CAArC;AACA,aAAKwB,aAAL;AACD,OAHM,MAGA,IAAIa,MAAM3C,IAAN,KAAe,oBAAnB,EAAyC;AAC9C,aAAK8B,aAAL;AACD;AACF;;;uCAEkBpB,I,EAAM4B,S,EAAWW,Q,EAAU;AAC5C,UAAMT,UAAUhC,mBAAQC,MAAR,CAAe,EAAEtC,MAAM,QAAR,EAAkBsE,QAAQ,CAAC,QAAD,CAA1B,EAAf,CAAhB;AACAhF,cAAQC,GAAR,CAAY,iBAAZ,EAA+B8E,OAA/B;AACA,WAAK3E,MAAL,CAAYF,aAAZ,CAA0B2E,SAA1B,EAAqCiB,MAArC,CAA4C5E,IAA5C,CAAiD6D,OAAjD;AACA,WAAKE,eAAL,CAAqB,KAAK7E,MAAL,CAAYF,aAAZ,CAA0B2E,SAA1B,EAAqCrD,QAA1D;AACD;;;6CAEwByB,I,EAAM4B,S,EAAWW,Q,EAAUN,K,EAAO;AACzDlF,cAAQC,GAAR,CAAY,0BAAZ;AACA,UAAIiF,MAAM3C,IAAN,KAAe,kBAAnB,EAAuC;AACrC,eAAO,KAAKrD,EAAL,CAAQiG,IAAR,CAAa,CAAC,EAAE5E,MAAM,QAAR,EAAkBC,OAAO,QAAzB,EAAD,CAAb,CAAP;AACD,OAFD,MAEO,IAAI0E,MAAM3C,IAAN,KAAe,QAAf,IAA2B2C,MAAME,MAAN,CAAa5E,KAAb,KAAuB,QAAtD,EAAgE;AACrE,aAAKJ,MAAL,CAAYF,aAAZ,CAA0B2E,SAA1B,EAAqCiB,MAArC,CAA4ChD,MAA5C,CAAmD0C,QAAnD,EAA6D,CAA7D;AACA,aAAKnB,aAAL;AACD,OAHM,MAGA,IAAIa,MAAM3C,IAAN,KAAe,oBAAnB,EAAyC;AAC9C,aAAK8B,aAAL;AACD;AACF;;;oCAEepB,I,EAAM4B,S,EAAWW,Q,EAAU;AACzC,UAAMT,UAAUhC,mBAAQC,MAAR,CAAe,EAAEtC,MAAM,IAAR,EAAcsE,QAAQ,CAAC,OAAD,EAAU,OAAV,CAAtB,EAAf,CAAhB;AACAhF,cAAQC,GAAR,CAAY,iBAAZ,EAA+B8E,OAA/B;AACA,WAAK3E,MAAL,CAAYF,aAAZ,CAA0B2E,SAA1B,EAAqCtF,EAArC,CAAwC2B,IAAxC,CAA6C6D,OAA7C;AACA,WAAKE,eAAL,CAAqB,KAAK7E,MAAL,CAAYF,aAAZ,CAA0B2E,SAA1B,EAAqCkB,KAA1D;AACD;;;0CAEqB9C,I,EAAM4B,S,EAAWW,Q,EAAUN,K,EAAO;AACtDlF,cAAQC,GAAR,CAAY,uBAAZ,EAAqCiF,KAArC;AACA,UAAIA,MAAM3C,IAAN,KAAe,mBAAf,IAAsC2C,MAAMQ,KAAN,CAAYnD,IAAZ,KAAqB,IAA/D,EAAqE;AACnE;AACA,YAAMoD,YAAY,CAAC,GAAD,CAAlB;AACA,eAAO1B,QAAQC,OAAR,CAAgB,KAAKjF,YAAL,CAAkBsG,YAAlB,CAA+BI,SAA/B,CAAhB,CAAP;AACD,OAJD,MAIO,IAAIT,MAAM3C,IAAN,KAAe,kBAAnB,EAAuC;AAC5C,eAAO,KAAKrD,EAAL,CAAQiG,IAAR,CAAa,CAAC,EAAE5E,MAAM,QAAR,EAAkBC,OAAO,QAAzB,EAAD,CAAb,CAAP;AACD,OAFM,MAEA,IAAI0E,MAAM3C,IAAN,KAAe,QAAf,IAA2B2C,MAAME,MAAN,CAAa5E,KAAb,KAAuB,QAAtD,EAAgE;AACrE,aAAKJ,MAAL,CAAYF,aAAZ,CAA0B2E,SAA1B,EAAqCtF,EAArC,CAAwCuD,MAAxC,CAA+C0C,QAA/C,EAAyD,CAAzD;AACD,OAFM,MAEA,IAAIN,MAAM3C,IAAN,KAAe,mBAAf,IAAsC2C,MAAMQ,KAAN,CAAYnD,IAAZ,KAAqB,QAA/D,EAAyE;AAC9E;AACAvC,gBAAQC,GAAR,CAAY,uBAAZ,EAAqC,KAAKG,MAAL,CAAYF,aAAZ,CAA0B2E,SAA1B,CAArC;AACA,YAAMb,UAAU,EAAhB;AACA,aAAK5D,MAAL,CAAYF,aAAZ,CAA0B2E,SAA1B,EAAqCY,UAArC,CAAgDnD,OAAhD,CAAwD,UAACW,IAAD,EAAU;AAChEe,kBAAQ9C,IAAR,CAAa+B,KAAK,QAAL,EAAe,CAAf,CAAb;AACD,SAFD;AAGA,eAAOgB,QAAQC,OAAR,CAAgB,KAAKjF,YAAL,CAAkBsG,YAAlB,CAA+BvB,OAA/B,CAAhB,CAAP;AACD,OARM,MAQA,IAAIkB,MAAM3C,IAAN,KAAe,mBAAf,IAAsC2C,MAAMQ,KAAN,CAAYnD,IAAZ,KAAqB,QAA/D,EAAyE;AAC9E,YAAMyB,WAAU,EAAhB;AACA,aAAK5D,MAAL,CAAYU,eAAZ,CAA4BwB,OAA5B,CAAoC,UAACW,IAAD,EAAU;AAC5Ce,mBAAQ9C,IAAR,CAAa+B,KAAK,QAAL,EAAe,CAAf,CAAb;AACD,SAFD;AAGA,eAAOgB,QAAQC,OAAR,CAAgB,KAAKjF,YAAL,CAAkBsG,YAAlB,CAA+BvB,QAA/B,CAAhB,CAAP;AACD,OANM,MAMA,IAAIkB,MAAM3C,IAAN,KAAe,oBAAnB,EAAyC;AAC9C,aAAK8B,aAAL;AACD,OAFM,MAEA;AACL,eAAOJ,QAAQC,OAAR,CAAgB,EAAhB,CAAP;AACD;AACF;;;wCAEmBjB,I,EAAM4B,S,EAAWW,Q,EAAU;AAC7C,UAAMT,UAAUhC,mBAAQC,MAAR,CAAe,EAAEtC,MAAM,OAAR,EAAiBsE,QAAQ,CAAC,QAAD,EAAW,OAAX,CAAzB,EAAf,CAAhB;AACAhF,cAAQC,GAAR,CAAY,iBAAZ,EAA+B8E,OAA/B;AACA,WAAK3E,MAAL,CAAYF,aAAZ,CAA0B2E,SAA1B,EAAqCmB,MAArC,CAA4C9E,IAA5C,CAAiD6D,OAAjD;AACA,WAAKE,eAAL,CAAqB,KAAK7E,MAAL,CAAYF,aAAZ,CAA0B2E,SAA1B,EAAqCoB,SAA1D;AACD;;;uCACkBpB,S,EAAW;AAC5B,WAAKzE,MAAL,CAAYF,aAAZ,CAA0B2E,SAA1B,EAAqC/C,KAArC,GAA6C,KAAK1B,MAAL,CAAYF,aAAZ,CAA0B2E,SAA1B,EAAqC/C,KAArC,CAA2CtB,KAAxF;AACA,WAAK6D,aAAL;AACD;;;8CAEyBpB,I,EAAM4B,S,EAAWW,Q,EAAUN,K,EAAO;AAC1DlF,cAAQC,GAAR,CAAY,2BAAZ,EAAyCiF,KAAzC;AACA,UAAIA,MAAM3C,IAAN,KAAe,kBAAnB,EAAuC;AACrC,eAAO,KAAKrD,EAAL,CAAQiG,IAAR,CAAa,CAAC,EAAE5E,MAAM,QAAR,EAAkBC,OAAO,QAAzB,EAAD,CAAb,CAAP;AACD,OAFD,MAEO,IAAI0E,MAAM3C,IAAN,KAAe,QAAf,IAA2B2C,MAAME,MAAN,CAAa5E,KAAb,KAAuB,QAAtD,EAAgE;AACrE,aAAKJ,MAAL,CAAYF,aAAZ,CAA0B2E,SAA1B,EAAqCmB,MAArC,CAA4ClD,MAA5C,CAAmD0C,QAAnD,EAA6D,CAA7D;AACA,aAAKnB,aAAL;AACD,OAHM,MAGA,IAAIa,MAAM3C,IAAN,KAAe,mBAAf,IAAsC2C,MAAMQ,KAAN,CAAYnD,IAAZ,KAAqB,OAA/D,EAAwE;AAC7E,YAAMyB,UAAU,KAAKkC,gBAAL,CAAsB,KAAK9F,MAAL,CAAYF,aAAZ,CAA0B2E,SAA1B,EAAqCY,UAA3D,EAAuE,KAAKrF,MAAL,CAAYF,aAAZ,CAA0B2E,SAA1B,EAAqCgB,IAA5G,CAAhB;AACA,eAAO5B,QAAQC,OAAR,CAAgB,KAAKjF,YAAL,CAAkBsG,YAAlB,CAA+BvB,OAA/B,CAAhB,CAAP;AACD,OAHM,MAGA,IAAIkB,MAAM3C,IAAN,KAAe,oBAAnB,EAAyC;AAC9C,aAAK8B,aAAL;AACD,OAFM,MAEA;AACL,eAAOJ,QAAQC,OAAR,CAAgB,EAAhB,CAAP;AACD;AACF;;;kCAEarB,K,EAAO;AACnB,UAAMkC,UAAUhC,mBAAQC,MAAR,CAAe,EAAEtC,MAAM,MAAR,EAAgBsE,QAAQ,CAAC,KAAD,EAAQ,OAAR,CAAxB,EAAf,CAAhB;AACAhF,cAAQC,GAAR,CAAY,eAAZ,EAA6B4C,KAA7B;AACA,WAAKzC,MAAL,CAAYqB,SAAZ,CAAsBP,IAAtB,CAA2B6D,OAA3B;AACA,WAAKE,eAAL,CAAqB,KAAKvD,OAA1B;AACD;;;wCAEmBuB,I,EAAMJ,K,EAAOqC,K,EAAO;AACtClF,cAAQC,GAAR,CAAY,qBAAZ,EAAmCiF,KAAnC;AACA,UAAIA,MAAM3C,IAAN,KAAe,kBAAnB,EAAuC;AACrC,eAAO,KAAKrD,EAAL,CAAQiG,IAAR,CAAa,CAAC,EAAE5E,MAAM,QAAR,EAAkBC,OAAO,QAAzB,EAAD,CAAb,CAAP;AACD,OAFD,MAEO,IAAI0E,MAAM3C,IAAN,KAAe,QAAf,IAA2B2C,MAAME,MAAN,CAAa5E,KAAb,KAAuB,QAAtD,EAAgE;AACrE;;AAEA,aAAKJ,MAAL,CAAYqB,SAAZ,CAAsBqB,MAAtB,CAA6BD,KAA7B,EAAoC,CAApC;AACA,aAAKwB,aAAL;AACA;AACD,OANM,MAMA,IAAIa,MAAM3C,IAAN,KAAe,mBAAf,IAAsC2C,MAAMQ,KAAN,CAAYnD,IAAZ,KAAqB,OAA/D,EAAwE;AAC7E,eAAO0B,QAAQC,OAAR,CAAgB,KAAKjF,YAAL,CAAkBsG,YAAlB,CAA+B,KAAKY,YAAL,EAA/B,CAAhB,CAAP;AACD,OAFM,MAEA,IAAIjB,MAAM3C,IAAN,KAAe,oBAAnB,EAAyC;AAC9C,aAAK8B,aAAL;AACD,OAFM,MAEA;AACL,eAAOJ,QAAQC,OAAR,CAAgB,EAAhB,CAAP;AACD;AACF;;;mCAEcrB,K,EAAO;AACpB,UAAMkC,UAAUhC,mBAAQC,MAAR,CAAe,EAAEtC,MAAM,OAAR,EAAiBsE,QAAQ,CAAC,QAAD,EAAW,OAAX,CAAzB,EAAf,CAAhB;AACAhF,cAAQC,GAAR,CAAY,eAAZ,EAA6B4C,KAA7B,EAAoCkC,OAApC;AACA,WAAK3E,MAAL,CAAYuB,UAAZ,CAAuBT,IAAvB,CAA4B6D,OAA5B;AACA,WAAKE,eAAL,CAAqB,KAAKrD,QAA1B;AACD;;;yCAEoBqB,I,EAAMJ,K,EAAOqC,K,EAAO;AACvC;AACA,UAAIA,MAAM3C,IAAN,KAAe,kBAAnB,EAAuC;AACrC,eAAO,KAAKrD,EAAL,CAAQiG,IAAR,CAAa,CAAC,EAAE5E,MAAM,QAAR,EAAkBC,OAAO,QAAzB,EAAD,CAAb,CAAP;AACD,OAFD,MAEO,IAAI0E,MAAM3C,IAAN,KAAe,QAAf,IAA2B2C,MAAME,MAAN,CAAa5E,KAAb,KAAuB,QAAtD,EAAgE;;AAErE,aAAKJ,MAAL,CAAYuB,UAAZ,CAAuBmB,MAAvB,CAA8BD,KAA9B,EAAqC,CAArC;AACA,aAAKwB,aAAL;AAED,OALM,MAKA,IAAIa,MAAM3C,IAAN,KAAe,mBAAnB,EAAwC;AAC7C,eAAO0B,QAAQC,OAAR,CAAgB,KAAKjF,YAAL,CAAkBsG,YAAlB,CAA+B,KAAKY,YAAL,EAA/B,CAAhB,CAAP;AACD,OAFM,MAEA,IAAIjB,MAAM3C,IAAN,KAAe,oBAAnB,EAAyC;AAC9C,aAAK8B,aAAL;AACD,OAFM,MAEA;AACL,eAAOJ,QAAQC,OAAR,CAAgB,EAAhB,CAAP;AACD;AACF;;;oCAEekC,M,EAAQ;AACtB,UAAMC,aAAa,KAAKpH,YAAL,CAAkB+B,aAAlB,EAAnB;AACAoF,aAAOE,IAAP,GAAcD,WAAWC,IAAzB;AACAF,aAAO5F,KAAP,GAAe6F,WAAW7F,KAA1B;AACD;;;8BAES;AACR,UAAM+F,WAAW;AACf7F,cAAM,WADS;AAEfG,eAAO,KAAK5B,YAAL,CAAkB2B,UAAlB,CAA6B,EAAE,SAAS,cAAX,EAA2B,QAAQ,IAAnC,EAA7B,CAFQ;AAGf6E,oBAAY,EAHG;AAIf1E,sBAAc,KAAK9B,YAAL,CAAkB+B,aAAlB,EAJC;AAKf4E,eAAO,EALQ;AAMfxE,kBAAU,KAAKnC,YAAL,CAAkB+B,aAAlB,EANK;AAOf6E,cAAM,EAPS;AAQfvE,gBAAQ,KAAKrC,YAAL,CAAkB+B,aAAlB,EARO;AASf8E,gBAAQ,EATO;AAUftE,kBAAU,KAAKvC,YAAL,CAAkB+B,aAAlB,EAVK;AAWfzB,YAAI,EAXW;AAYfwG,eAAO,KAAK9G,YAAL,CAAkB+B,aAAlB,EAZQ;AAafgF,gBAAQ,EAbO;AAcfC,mBAAW,KAAKhH,YAAL,CAAkB+B,aAAlB,EAdI;AAefc,eAAO,KAAK7C,YAAL,CAAkB2B,UAAlB,CAA6B,EAAE,SAAS,MAAX,EAAmB,QAAQ,IAA3B,EAA7B;AAfQ,OAAjB;AAiBA,WAAKR,MAAL,CAAYF,aAAZ,CAA0BgB,IAA1B,CAA+BqF,QAA/B;AACAvG,cAAQC,GAAR,CAAY,SAAZ,EAAuB,KAAKG,MAAL,CAAYF,aAAnC;AACD;;;4BACO2C,K,EAAO;AACb,WAAKzC,MAAL,CAAYF,aAAZ,CAA0B4C,MAA1B,CAAiCD,KAAjC,EAAwC,CAAxC;AACD;;;mCAEc;AACb;;AAEA,UAAM2D,aAAa,KAAKN,gBAAL,CAAsB,KAAK9F,MAAL,CAAYU,eAAlC,EAAmD,KAAKV,MAAL,CAAYiB,QAA/D,CAAnB;AACA,UAAMoF,eAAe,EAArB;AACA,WAAKrG,MAAL,CAAYF,aAAZ,CAA0BoC,OAA1B,CAAkC,UAACL,KAAD,EAAW;AAC3CjC,gBAAQC,GAAR,CAAY,UAAZ,EAAwBgC,MAAM+D,MAA9B;AACA/D,cAAM+D,MAAN,CAAa1D,OAAb,CAAqB,UAACW,IAAD,EAAU;AAC7BjD,kBAAQC,GAAR,CAAY,UAAZ,EAAwBgD,IAAxB;AACAwD,uBAAavF,IAAb,CAAkB+B,KAAK+B,MAAL,CAAY,CAAZ,CAAlB,EAF6B,CAEK;AACnC,SAHD;AAID,OAND;AAOA,aAAOwB,WAAWE,MAAX,CAAkBD,YAAlB,CAAP;AACD;;;qCAEgBhB,U,EAAYI,I,EAAM;AACjC;AACA,UAAM7B,UAAU,EAAhB;AACAyB,iBAAWnD,OAAX,CAAmB,UAACW,IAAD,EAAU;AAC3B;AACAe,gBAAQ9C,IAAR,CAAa+B,KAAK,QAAL,EAAe,CAAf,CAAb;AACD,OAHD;AAIA4C,WAAKvD,OAAL,CAAa,UAACW,IAAD,EAAU;AACrB;AACAjD,gBAAQC,GAAR,CAAY,2BAAZ,EAAyCgD,IAAzC;;AAFqB,0CAGIA,KAAK+B,MAHT;AAAA,YAGd2B,OAHc;AAAA,YAGLC,KAHK;;AAIrB5C,gBAAQ9C,IAAR,CAAa,CAAC0F,KAAD,EAAQD,OAAR,EAAiBE,IAAjB,CAAsB,GAAtB,CAAb;AACA;AACD,OAND;AAOA,aAAO7C,OAAP;AACD;;;oCAEe;AAAA;;AACd;AACA;AACA,WAAK5D,MAAL,CAAY6B,KAAZ,GAAoB;AAClB;AACA,kBAAU;AACR,kBAAQ,EADA;AAER,oBAAU,EAFF;AAGR,oBAAU,EAHF;AAIR,sBAAY,EAJJ;AAKR,yBAAe,EALP;AAMR,kBAAQ;AANA,SAFQ;AAUlB,gBAAQ,EAVU;AAWlB,gBAAQ,EAXU;AAYlB,kBAAU,EAZQ;AAalB,iBAAS;AAbS,OAApB;;AAgBA;AACA,WAAK7B,MAAL,CAAY6B,KAAZ,CAAkB6E,MAAlB,CAAyBC,IAAzB,GAAgC,KAAK3G,MAAL,CAAYS,KAA5C;;AAEA;AACA,WAAKT,MAAL,CAAY6B,KAAZ,CAAkB6E,MAAlB,CAAyBhF,KAAzB,GAAiCkF,SAAS,KAAK5G,MAAL,CAAY4B,UAArB,CAAjC;;AAEA;AACA,WAAK5B,MAAL,CAAYU,eAAZ,CAA4BwB,OAA5B,CAAoC,UAACW,IAAD,EAAU;AAC5C,eAAK7C,MAAL,CAAY6B,KAAZ,CAAkB6E,MAAlB,CAAyBG,MAAzB,CAAgC/F,IAAhC,CAAqC+B,KAAK+B,MAAL,CAAY,CAAZ,CAArC;AACD,OAFD;AAGA;AACA,UAAMkC,mBAAmB;AACvB,aAAK,EADkB;AAEvB,aAAK,MAFkB;AAGvB,cAAM,OAHiB;AAIvB,aAAK,MAJkB;AAKvB,cAAM,OALiB;AAMvB,oBAAY,YANW;AAOvB,sBAAc,cAPS;AAQvB,oBAAY,YARW;AASvB,iBAAS,SATc;AAUvB,cAAM;AAER;AAZyB,OAAzB,CAaA,KAAK9G,MAAL,CAAYe,UAAZ,CAAuBmB,OAAvB,CAA+B,UAACW,IAAD,EAAU;AACvC;AACA,YAAMkE,SAASD,iBAAiBjE,KAAK+B,MAAL,CAAY,CAAZ,CAAjB,CAAf;AACA,YAAMtC,WAASO,KAAK+B,MAAL,CAAY,CAAZ,CAAT,GAA0BmC,MAAhC;AACA,YAAIlE,KAAK+B,MAAL,CAAY,CAAZ,MAAmB,IAAvB,EAA6B;AAC3B;AACA,iBAAK5E,MAAL,CAAY6B,KAAZ,CAAkB6E,MAAlB,CAAyBM,MAAzB,CAAgC1E,GAAhC,IAAuC2E,KAAKC,KAAL,CAAWrE,KAAK+B,MAAL,CAAY,CAAZ,CAAX,CAAvC;AAED,SAJD,MAIO;AACL,cAAK/B,KAAK+B,MAAL,CAAY,CAAZ,EAAeuC,UAAf,CAA0B,IAA1B,KAAmCtE,KAAK+B,MAAL,CAAY,CAAZ,EAAewC,QAAf,CAAwB,IAAxB,CAApC,IAAuEvE,KAAK+B,MAAL,CAAY,CAAZ,EAAeuC,UAAf,CAA0B,IAA1B,KAAmCtE,KAAK+B,MAAL,CAAY,CAAZ,EAAewC,QAAf,CAAwB,IAAxB,CAA9G,EAA8I;AAC5I,gBAAMC,SAASxE,KAAK+B,MAAL,CAAY,CAAZ,CAAf;AACA,mBAAK5E,MAAL,CAAY6B,KAAZ,CAAkB6E,MAAlB,CAAyBM,MAAzB,CAAgC1E,GAAhC,IAAuC+E,OAAOC,KAAP,CAAa,CAAb,EAAgBD,OAAO7E,MAAP,GAAgB,CAAhC,CAAvC;AACA;AACD,WAJD,MAIO,IAAI,CAAC+E,MAAMC,WAAW3E,KAAK+B,MAAL,CAAY,CAAZ,CAAX,CAAN,CAAL,EAAwC;AAC7C,mBAAK5E,MAAL,CAAY6B,KAAZ,CAAkB6E,MAAlB,CAAyBM,MAAzB,CAAgC1E,GAAhC,IAAuCkF,WAAW3E,KAAK+B,MAAL,CAAY,CAAZ,CAAX,CAAvC;AACAhF,oBAAQC,GAAR,CAAa,OAAKG,MAAL,CAAY6B,KAAZ,CAAkB6E,MAAlB,CAAyBM,MAAtC;AACD,WAHM,MAIF,IAAIS,OAAOC,IAAP,CAAY,OAAK5F,QAAjB,EAA2BkC,OAA3B,CAAmCnB,KAAK+B,MAAL,CAAY,CAAZ,CAAnC,CAAJ,EAAyD;AAC5D,mBAAK5E,MAAL,CAAY6B,KAAZ,CAAkB6E,MAAlB,CAAyBM,MAAzB,CAAgC1E,GAAhC,IAAuCO,KAAK+B,MAAL,CAAY,CAAZ,CAAvC;AACD,WAFI,MAGA,IAAI/B,KAAK+B,MAAL,CAAY,CAAZ,EAAe+C,WAAf,OAAiC,MAArC,EAA6C;AAChD,mBAAK3H,MAAL,CAAY6B,KAAZ,CAAkB6E,MAAlB,CAAyBM,MAAzB,CAAgC1E,GAAhC,IAAuC,IAAvC;AACD,WAFI,MAEE,IAAIO,KAAK+B,MAAL,CAAY,CAAZ,EAAe+C,WAAf,OAAiC,OAArC,EAA8C;AACnD,mBAAK3H,MAAL,CAAY6B,KAAZ,CAAkB6E,MAAlB,CAAyBM,MAAzB,CAAgC1E,GAAhC,IAAuC,KAAvC;AACD,WAFM,MAGF;AACH,mBAAOuB,QAAQ+D,MAAR,CAAe;AACpBjE,uBAAS;AADW,aAAf,CAAP;AAGD;AACF;AACF,OA/BD;;AAiCA;AACA;AACA,WAAK3D,MAAL,CAAYiB,QAAZ,CAAqBiB,OAArB,CAA6B,UAACW,IAAD,EAAU;AAAA,2CAEZA,KAAK+B,MAFO;AAAA,YAE9B2B,OAF8B;AAAA,YAErBC,KAFqB;;AAMrC,eAAKxG,MAAL,CAAY6B,KAAZ,CAAkB6E,MAAlB,CAAyBmB,WAAzB,CAAqC/G,IAArC,CAA0C,CAAC0F,KAAD,EAAQD,OAAR,EAAiBE,IAAjB,CAAsB,IAAtB,CAA1C;AACD,OAPD;;AASA;AACA,WAAKzG,MAAL,CAAYmB,UAAZ,CAAuBe,OAAvB,CAA+B,UAACW,IAAD,EAAU;AACvCjD,gBAAQC,GAAR,CAAY,YAAZ,EAA0BgD,IAA1B;AACA,eAAK7C,MAAL,CAAY6B,KAAZ,CAAkB6E,MAAlB,CAAyBoB,QAAzB,CAAkChH,IAAlC,CAAuC+B,KAAK+B,MAAL,CAAY,CAAZ,CAAvC;AACD,OAHD;;AAKA;AACA,WAAK5E,MAAL,CAAYF,aAAZ,CAA0BoC,OAA1B,CAAkC,UAACL,KAAD,EAAW;AAC3CjC,gBAAQC,GAAR,CAAY,eAAZ,EAA6BgC,KAA7B;AACA,YAAMkG,YAAY,EAAlB;AACA;AACAA,kBAAUzH,IAAV,GAAiBuB,MAAMvB,IAAvB;AACAyH,kBAAUlG,KAAV,GAAkB,EAAE,UAAU,EAAZ,EAAlB;AACAjC,gBAAQC,GAAR,CAAY,eAAZ,EAA6BgC,KAA7B;AACA;AACAkG,kBAAUlG,KAAV,CAAgB6E,MAAhB,CAAuBC,IAAvB,GAA8B9E,MAAMpB,KAAN,CAAYL,KAA1C;AACAR,gBAAQC,GAAR,CAAY,eAAZ,EAA6BkI,UAAUlG,KAAV,CAAgB6E,MAAhB,CAAuBC,IAApD;AACA;AACAoB,kBAAUlG,KAAV,CAAgB6E,MAAhB,CAAuBG,MAAvB,GAAgC,EAAhC;AACAhF,cAAMwD,UAAN,CAAiBnD,OAAjB,CAAyB,UAACW,IAAD,EAAU;AACjCjD,kBAAQC,GAAR,CAAY,YAAZ,EAA0BgD,IAA1B;AACAkF,oBAAUlG,KAAV,CAAgB6E,MAAhB,CAAuBG,MAAvB,CAA8B/F,IAA9B,CAAmC+B,KAAK+B,MAAL,CAAY,CAAZ,CAAnC;AACD,SAHD;AAIA;AACAmD,kBAAUlG,KAAV,CAAgB6E,MAAhB,CAAuBM,MAAvB,GAAgC,EAAhC;AACAnF,cAAM2D,KAAN,CAAYtD,OAAZ,CAAoB,UAACW,IAAD,EAAU;AAC5B,cAAMkE,SAASD,iBAAiBjE,KAAK+B,MAAL,CAAY,CAAZ,CAAjB,CAAf;AACA,cAAMtC,WAASO,KAAK+B,MAAL,CAAY,CAAZ,CAAT,GAA0BmC,MAAhC;;AAEA,cAAIlE,KAAK+B,MAAL,CAAY,CAAZ,MAAmB,IAAvB,EAA6B;AAC3BhF,oBAAQC,GAAR,CAAY,WAAZ,EAAyBgD,KAAK+B,MAAL,CAAY,CAAZ,CAAzB,UAAgD/B,KAAK+B,MAAL,CAAY,CAAZ,CAAhD;AACAmD,sBAAUlG,KAAV,CAAgB6E,MAAhB,CAAuBM,MAAvB,CAA8B1E,GAA9B,IAAqC2E,KAAKC,KAAL,CAAWrE,KAAK+B,MAAL,CAAY,CAAZ,CAAX,CAArC;AACD,WAHD,MAGO;AACLhF,oBAAQC,GAAR,CAAY,WAAZ,EAAyBgD,KAAK+B,MAAL,CAAY,CAAZ,CAAzB;AACA,gBAAK/B,KAAK+B,MAAL,CAAY,CAAZ,EAAeuC,UAAf,CAA0B,IAA1B,KAAmCtE,KAAK+B,MAAL,CAAY,CAAZ,EAAewC,QAAf,CAAwB,IAAxB,CAApC,IAAuEvE,KAAK+B,MAAL,CAAY,CAAZ,EAAeuC,UAAf,CAA0B,IAA1B,KAAmCtE,KAAK+B,MAAL,CAAY,CAAZ,EAAewC,QAAf,CAAwB,IAAxB,CAA9G,EAA8I;AAC5I,kBAAMC,SAASxE,KAAK+B,MAAL,CAAY,CAAZ,CAAf;AACAmD,wBAAUlG,KAAV,CAAgB6E,MAAhB,CAAuBM,MAAvB,CAA8B1E,GAA9B,IAAqC+E,OAAOC,KAAP,CAAa,CAAb,EAAgBD,OAAO7E,MAAP,GAAgB,CAAhC,CAArC;AACD,aAHD,MAGO,IAAI,CAAC+E,MAAMC,WAAW3E,KAAK+B,MAAL,CAAY,CAAZ,CAAX,CAAN,CAAL,EAAwC;AAC7CmD,wBAAUlG,KAAV,CAAgB6E,MAAhB,CAAuBM,MAAvB,CAA8B1E,GAA9B,IAAqCkF,WAAW3E,KAAK+B,MAAL,CAAY,CAAZ,CAAX,CAArC;AACD,aAFM,MAEA;AACL,qBAAOf,QAAQ+D,MAAR,CAAe;AACpBjE,yBAAS;AADW,eAAf,CAAP;AAGD;AAEF;;AAED/D,kBAAQC,GAAR,CAAY,YAAZ,EAA0ByC,GAA1B,EAA+ByF,UAAUlG,KAAV,CAAgB6E,MAAhB,CAAuBM,MAAtD;AACD,SAvBD;AAwBA;AACA;AACAe,kBAAUlG,KAAV,CAAgB6E,MAAhB,CAAuBmB,WAAvB,GAAqC,EAArC;AACAhG,cAAM4D,IAAN,CAAWvD,OAAX,CAAmB,UAACW,IAAD,EAAU;AAC3BjD,kBAAQC,GAAR,CAAY,kBAAZ,EAAgCgD,IAAhC;;AAD2B,6CAEFA,KAAK+B,MAFH;AAAA,cAEpB2B,OAFoB;AAAA,cAEXC,KAFW;AAG3B;;;AACAuB,oBAAUlG,KAAV,CAAgB6E,MAAhB,CAAuBmB,WAAvB,CAAmC/G,IAAnC,CAAwC,CAAC0F,KAAD,EAAQD,OAAR,EAAiBE,IAAjB,CAAsB,IAAtB,CAAxC;AACD,SALD;AAMA;AACAsB,kBAAUlG,KAAV,CAAgB6E,MAAhB,CAAuBoB,QAAvB,GAAkC,EAAlC;AACAjG,cAAM6D,MAAN,CAAaxD,OAAb,CAAqB,UAACW,IAAD,EAAU;AAC7B;AACAkF,oBAAUlG,KAAV,CAAgB6E,MAAhB,CAAuBoB,QAAvB,CAAgChH,IAAhC,CAAqC+B,KAAK+B,MAAL,CAAY,CAAZ,CAArC;AACD,SAHD;AAIA;AACAmD,kBAAU5I,EAAV,GAAe,EAAf;AACA0C,cAAM1C,EAAN,CAAS+C,OAAT,CAAiB,UAACW,IAAD,EAAU;AACzBkF,oBAAU5I,EAAV,CAAa0D,KAAK+B,MAAL,CAAY,CAAZ,CAAb,IAA+B/B,KAAK+B,MAAL,CAAY,CAAZ,CAA/B;AACD,SAFD;AAGA;AACAmD,kBAAUnC,MAAV,GAAmB,EAAnB;AACA/D,cAAM+D,MAAN,CAAa1D,OAAb,CAAqB,UAACW,IAAD,EAAU;AAC7BjD,kBAAQC,GAAR,CAAY,WAAZ;AACAkI,oBAAUnC,MAAV,CAAiB9E,IAAjB,CAAsB+B,KAAK+B,MAAL,CAAY6B,IAAZ,CAAiB,GAAjB,CAAtB;AACD,SAHD;AAIA;AACAsB,kBAAUrG,KAAV,GAAkBkF,SAAS/E,MAAMH,KAAN,CAAYtB,KAArB,CAAlB;AACA,eAAKJ,MAAL,CAAY6B,KAAZ,CAAkB4E,IAAlB,CAAuB3F,IAAvB,CAA4BiH,SAA5B;AACD,OAvED;;AAyEA;AACA,WAAK/H,MAAL,CAAYqB,SAAZ,CAAsBa,OAAtB,CAA8B,UAACW,IAAD,EAAU;AACtCjD,gBAAQC,GAAR,CAAY,WAAZ,EAAyBgD,IAAzB;AACA,YAAMmF,UAAUnF,KAAK+B,MAAL,CAAY,CAAZ,MAAmB,KAAnB,GAA2B/B,KAAK+B,MAAL,CAAY,CAAZ,CAA3B,SAAgD/B,KAAK+B,MAAL,CAAY,CAAZ,CAAhE;AACA,eAAK5E,MAAL,CAAY6B,KAAZ,CAAkBoG,IAAlB,CAAuBnH,IAAvB,CAA4BkH,OAA5B;AACD,OAJD;;AAMA;AACA,WAAKhI,MAAL,CAAYuB,UAAZ,CAAuBW,OAAvB,CAA+B,UAACW,IAAD,EAAU;AACvCjD,gBAAQC,GAAR,CAAY,YAAZ,EAA0BgD,KAAK+B,MAA/B,EAAuC,YAAvC;;AAEA,eAAK5E,MAAL,CAAY6B,KAAZ,CAAkBgF,MAAlB,CAAyB/F,IAAzB,CAA8B+B,KAAK+B,MAAL,CAAY6B,IAAZ,CAAiB,GAAjB,CAA9B;AACD,OAJD;;AAMA;AACA,WAAKzG,MAAL,CAAY6B,KAAZ,CAAkBH,KAAlB,GAA0BkF,SAAS,KAAK5G,MAAL,CAAY0B,KAArB,CAA1B;AACA;AACA;AACA;AACA,WAAK1B,MAAL,CAAYA,MAAZ,GAAqBiH,KAAKiB,SAAL,CAAe,KAAKlI,MAAL,CAAY6B,KAA3B,CAArB;AACA;AACA;;AAEA;;AAEA;;;AAGA;AACA;AACA,WAAK5C,SAAL,CAAekJ,OAAf;AAED;;;;EA7vB6CC,c;;AA+vBhD1J,2BAA2B2J,WAA3B,GAAyC,4BAAzC","file":"query_ctrl.js","sourcesContent":["import './css/query-editor.css!'\r\n\r\nimport _ from 'lodash';\r\nimport { QueryCtrl } from 'app/plugins/sdk';\r\nimport sqlPart from './sql_part';\r\nimport { PanelEvents } from '@grafana/data';\r\nimport { MetricsPanelCtrl } from 'app/plugins/sdk';\r\nexport class GenericDatasourceQueryCtrl extends QueryCtrl {\r\n  \r\n  constructor($scope, $injector, uiSegmentSrv, $q) {\r\n    super($scope, $injector);\r\n    this.scope = $scope;\r\n    this.uiSegmentSrv = uiSegmentSrv;\r\n    this.$q = $q;\r\n    this.lastQueryError = null;\r\n    this.panelCtrl.events.on(PanelEvents.dataReceived, this.onDataReceived.bind(this), $scope);\r\n    this.panelCtrl.events.on(PanelEvents.dataError, this.onDataError.bind(this), $scope);\r\n    \r\n    this.panelCtrl.events.on(PanelEvents.render, this.onDataRefresh.bind(this), $scope)\r\n    console.log(this,  '11111111111111111111');\r\n    this.joinQueryList = this.joinQueryList || [];\r\n    this.updateProjection()\r\n\r\n    this.target.tableSelect = this.target.tableSelect || [];\r\n\r\n    this.formats = [\r\n      { text: 'Time series', value: 'grafana.timeserie' },\r\n      { text: 'Table', value: 'grafana.table' },\r\n\r\n    ];\r\n    this.types = [\r\n      { text: 'Left Join', value: 'left_join' },\r\n      { text: 'Inner Join', value: 'inner_join' },\r\n      { text: 'Full Join', value: 'full_join' }\r\n    ];\r\n\r\n\r\n    // this.target.tableSegment = null;\r\n    this.target.target = this.target.target || '';\r\n    this.target.type = this.target.type || 'grafana.timeserie';\r\n\r\n    this.target.tableSegment = this.uiSegmentSrv.newSegment({ \"value\": this.target.table || 'select table', \"fake\": true });\r\n    this.target.table = this.target.table || this.target.tableSegment.value;\r\n\r\n    this.target.selectionsParts = this.target.selectionsParts || []\r\n    this.selectionAdd = this.uiSegmentSrv.newPlusButton();\r\n\r\n    this.selectMenu = [];\r\n    this.selectMenu.push(this.uiSegmentSrv.newSegment({ type: 'expression', value: 'Expression' }));\r\n    // this.selectionsParts = this.selectionsParts || [];\r\n    this.target.whereParts = this.target.whereParts || []\r\n    this.whereAdd = this.uiSegmentSrv.newPlusButton();\r\n    this.target.aggParts = this.target.aggParts || [];\r\n    this.aggAdd = this.uiSegmentSrv.newPlusButton();\r\n    this.target.groupParts = this.target.groupParts || []\r\n    this.groupAdd = this.uiSegmentSrv.newPlusButton();\r\n    this.target.joinQueryList = this.target.joinQueryList||[]\r\n    \r\n    this.target.sortParts = this.target.sortParts || [];\r\n    this.sortAdd = this.uiSegmentSrv.newPlusButton();\r\n    this.target.fieldParts = this.target.fieldParts || []\r\n    this.fieldAdd = this.uiSegmentSrv.newPlusButton();\r\n\r\n    this.target.limitSegment = this.uiSegmentSrv.newSegment({ \"value\": this.target.limit || '1000', \"fake\": true });\r\n    this.target.limit = this.target.limitSegment.value || '1000';\r\n    this.target.queryLimitSegment = this.uiSegmentSrv.newSegment({ \"value\": this.target.queryLimit || '1000', \"fake\": true });\r\n    this.target.queryLimit = this.target.queryLimitSegment.value || '1000';\r\n    this.target.query = this.target.query|| {\r\n      // restSql协议结构定义\r\n      \"select\": {\r\n        \"from\": \"\",\r\n        \"filter\": {},\r\n        \"group_by\": [],\r\n        \"aggregation\": [],\r\n        \"sort\": [],\r\n      },\r\n      \"join\": [],\r\n      \"sort\": [],\r\n      \"fields\": [],\r\n      \"limit\": 200\r\n    };\r\n\r\n    this.varables = this.varables|| []\r\n    this.panelCtrl.datasource.templateSrv.variables.forEach(ele => {\r\n      //  console.log(ele, '🐷');\r\n      this.varables.push({\r\n        name:'$'+ ele.name,\r\n        value: ele.current.value\r\n      })\r\n    });\r\n  }\r\n  updateProjection() {\r\n    if (this.target.target ) {\r\n      for (const key in this.target) {\r\n        if (key.includes('Parts')&&this.target[key].length>0) {\r\n          this.target[key].forEach((ele, index) => {\r\n            this.target[key].splice(index,1,sqlPart.create(ele.part))\r\n          })\r\n        } else if (key.includes('Segment')) {\r\n            this.target[key] = this.uiSegmentSrv.newSegment({ \"value\": this.target[key].value,\"fake\":true})\r\n        } else {\r\n          this.target.type = this.target.type\r\n        }\r\n      }\r\n      if (this.target.joinQueryList.length > 0) {\r\n        this.target.joinQueryList.forEach((ele, index) => {\r\n          for (const key in ele) {\r\n            if (Array.isArray(ele[key] && ele[key].length > 0)) {\r\n              ele[key].forEach((element, i) => {\r\n                ele[key].splice(i, 0, sqlPart.create(element.part))\r\n              })\r\n            } else if (key.includes('Add')) {\r\n              ele[key] = this.uiSegmentSrv.newPlusButton()\r\n            } else if (key == 'type') {\r\n              ele[key] = ele.type\r\n            } else if (key == 'table'||key=='limit') {\r\n              ele[key] = this.uiSegmentSrv.newSegment({ \"value\": ele[key].value, \"fake\": true })\r\n            }\r\n          }\r\n        })\r\n      }\r\n    }\r\n   \r\n    \r\n  }\r\n  onDataRefresh() {\r\n    // console.log('数据重新加载了');\r\n  }\r\n \r\n  transformToSegments() {\r\n    return (result) => {\r\n      const segments = _.map(results, segment => {\r\n        return this.uiSegmentSrv.newSegment({\r\n          value: segment.text,\r\n          expandable: segment.expandable,\r\n        });\r\n      });\r\n      return segments;\r\n    }\r\n  }\r\n\r\n  onDataReceived(dataList) {\r\n    console.log(dataList);\r\n    this.lastQueryError = null\r\n  }\r\n  onDataError(err) {\r\n    if (this.target.target) {\r\n      this.lastQueryError = err.message\r\n    }\r\n\r\n  }\r\n\r\n  getOptions() {\r\n    const options = [];\r\n    options.push(this.uiSegmentSrv.newSegment({ type: 'expression', value: 'Expression' }));\r\n    console.log(\"tttttt getOptions\", options);\r\n    return Promise.resolve(options);\r\n  }\r\n\r\n  removePart(parts, part) {\r\n    const index = _.indexOf(parts, part);\r\n    parts.splice(index, 1);\r\n  }\r\n\r\n  onFormatChanged() {\r\n    // this.datasource.metricVariables\r\n    this.updateRestSql();\r\n  }\r\n  onJoinTypeChange() {\r\n    console.log('😡😂');\r\n    this.updateRestSql();\r\n  }\r\n\r\n  onTableChanged() {\r\n    console.log(\"tableChanged\", this, this.target.tableSegment.value);\r\n    this.target.table = this.target.tableSegment.value;\r\n    let parth = 'getList';\r\n    this.datasource.metricFindOption(this.target.table, parth).then(result => {\r\n      if (result.status === 200) {\r\n        this.target.tableSelect = result.data.data.tables[0].rows;\r\n      }\r\n    })\r\n    this.updateRestSql();\r\n  }\r\n\r\n  onJoinTableChanged(joinIndex) {\r\n    console.log(\"onJoinTableChanged\", joinIndex);\r\n    // this.target.joinQueryList[joinIndex].table = ;\r\n    this.updateRestSql();\r\n  }\r\n\r\n  onLimitChanged() {\r\n    // console.log(\"onLimitChanged\");\r\n    this.target.limit = this.target.limitSegment.value;\r\n    this.updateRestSql();\r\n  }\r\n  onLimitQueryChanged() {\r\n    this.target.queryLimit = this.target.queryLimitSegment.value;\r\n    this.updateRestSql()\r\n  }\r\n  onLimitJoinChanged(joinIndex) {\r\n    this.target.joinQueryList[joinIndex].limit = this.uiSegmentSrv.newSegment({ \"value\": this.target.joinQueryList[joinIndex].limit.value || '1000', \"fake\": true });\r\n    this.updateRestSql()\r\n  }\r\n\r\n  addSelectionAction(part, index) {\r\n    console.log(1111, part, index);\r\n    this.getOptions()\r\n    const express = sqlPart.create({ type: 'column', params: ['column'] });\r\n    this.target.selectionsParts.push(express);\r\n    this.resetPlusButton(this.selectionAdd);\r\n  }\r\n\r\n  handleSelectionsPartEvent(part, index, event) {\r\n    console.log(\"tttttt handleSelectionsPartEvent\", event, index, part, '---');\r\n    // if (event.name = \"get-param-options\")\r\n    if (event.name === \"get-part-actions\") {\r\n      return this.$q.when([{ text: 'Remove', value: 'remove' }]);\r\n\r\n    } else if (event.name === \"action\" && event.action.value === \"remove\") {\r\n      this.removePart(this.target.selectionsParts, part);\r\n      // this.target.selectionsParts.splice(index, 1, null);\r\n      this.updateRestSql()\r\n      console.log(this.target.selectionsParts, '------')\r\n    } else if (event.name === \"part-param-changed\") {\r\n      // console.log(this.target.selectionsParts);\r\n      this.target.selectionsParts.forEach((item, i) => {\r\n      })\r\n      this.updateRestSql();\r\n    } else if (event.name === \"get-param-options\") {\r\n      return Promise.resolve(this.uiSegmentSrv.newOperators(this.target.tableSelect));\r\n    }\r\n  }\r\n\r\n  addJoinSelectionAction(joinIndex, expIndex) {\r\n    console.log(\"addJoinSelectionAction\", joinIndex, expIndex);\r\n    const express = sqlPart.create({ type: 'column', params: ['column'] });\r\n    this.target.joinQueryList[joinIndex].selections.push(express)\r\n    this.resetPlusButton(this.target.joinQueryList[joinIndex].selectionAdd);\r\n  }\r\n\r\n  handleJoinSelectionsPartEvent(part, joinIndex, expIndex, event) {\r\n    console.log(\"handleJoinSelectionsPartEvent\", joinIndex, expIndex);\r\n    if (event.name === \"get-part-actions\") {\r\n      return this.$q.when([{ text: 'Remove', value: 'remove' }]);\r\n    } else if (event.name === \"action\" && event.action.value === \"remove\") {\r\n      // this.removePart(this.target.joinQueryList[joinIndex].selections, part);\r\n      this.target.joinQueryList[joinIndex].selections.splice(expIndex, 1);\r\n      this.updateRestSql()\r\n    } else if (event.name === \"part-param-changed\") {\r\n      this.updateRestSql();\r\n    }\r\n  }\r\n\r\n  addWhereAction(part, index) {\r\n    const express = sqlPart.create({ type: 'expression', params: ['column', '=', 'value'] });\r\n\r\n    this.target.whereParts.push(express);\r\n    this.resetPlusButton(this.whereAdd);\r\n  }\r\n\r\n\r\n  handleWherePartEvent(part, index, event) {\r\n    // console.log(\"handleWherePartEvent\", part, index, event);\r\n    if (event.name === \"get-param-options\" && event.param.name === \"op\") {\r\n      // 暂时只支持展开操作符列表\r\n      const operators = ['=', '<', '<=', '>', '>=', 'CONTAINS', 'STARTSWITH', 'ENDSWITH', 'RANGE', 'IN'];\r\n      return Promise.resolve(this.uiSegmentSrv.newOperators(operators));\r\n    } else if (event.name === \"get-part-actions\") {\r\n      return this.$q.when([{ text: 'Remove', value: 'remove' }]);\r\n    } else if (event.name === \"action\" && event.action.value === \"remove\") {\r\n      this.target.whereParts.splice(index, 1);\r\n      this.updateRestSql()\r\n    } else if (event.name === \"part-param-changed\") {\r\n      console.log(part,index,'😎');\r\n      this.updateRestSql();\r\n    } else {\r\n      return Promise.resolve([]);\r\n    }\r\n  }\r\n\r\n  addJoinWhereAction(joinIndex, expIndex) {\r\n    const express = sqlPart.create({ type: 'expression', params: ['column', '=', 'value'] });\r\n    console.log(\"addWhereAction\", express);\r\n    this.target.joinQueryList[joinIndex].where.push(express);\r\n    this.resetPlusButton(this.target.joinQueryList[joinIndex].whereAdd);\r\n  }\r\n\r\n  handleJoinWherePartEvent(part, joinIndex, expIndex, event) {\r\n    console.log(\"handleJoinWherePartEvent\", event);\r\n    if (event.name === \"get-param-options\" && event.param.name === \"op\") {\r\n      // 暂时只支持展开操作符列表\r\n      const operators = ['=', '<', '<=', '>', '>=', 'CONTAINS', 'STARTSWITH', 'ENDSWITH', 'RANGE', 'IN'];\r\n      return Promise.resolve(this.uiSegmentSrv.newOperators(operators));\r\n    } else if (event.name === \"get-part-actions\") {\r\n      return this.$q.when([{ text: 'Remove', value: 'remove' }]);\r\n    } else if (event.name === \"action\" && event.action.value === \"remove\") {\r\n      this.target.joinQueryList[joinIndex].where.splice(expIndex, 1);\r\n    } else if (event.name === \"part-param-changed\") {\r\n      this.updateRestSql();\r\n    } else {\r\n      return Promise.resolve([]);\r\n    }\r\n  }\r\n\r\n  addAggAction() {\r\n    const express = sqlPart.create({ type: 'aggregate', params: ['avg', 'column'] });\r\n    console.log(\"addAggAction\", express);\r\n    this.target.aggParts.push(express);\r\n    this.resetPlusButton(this.aggAdd);\r\n  }\r\n\r\n  handleAggPartEvent(part, index, event) {\r\n    console.log(\"handleAggPartEvent\", event, part, index);\r\n    if (event.name === \"get-param-options\" && event.param.name === \"agg\") {\r\n      // 暂时只支持展开操作符列表\r\n      const operators = event.param.options;\r\n      return Promise.resolve(this.uiSegmentSrv.newOperators(operators));\r\n    } else if (event.name === \"get-part-actions\") {\r\n      return this.$q.when([{ text: 'Remove', value: 'remove' }]);\r\n    } else if (event.name === \"action\" && event.action.value === \"remove\") {\r\n      this.target.aggParts.splice(index, 1)\r\n      this.updateRestSql()\r\n    } else if (event.name === \"part-param-changed\") {\r\n      this.updateRestSql();\r\n    } else {\r\n      return Promise.resolve([]);\r\n    }\r\n  }\r\n\r\n  addJoinAggAction(joinIndex) {\r\n    const express = sqlPart.create({ type: 'aggregate', params: ['avg', 'column'] });\r\n    console.log(\"addJoinAggAction\", express);\r\n    this.target.joinQueryList[joinIndex].aggs.push(express);\r\n    this.resetPlusButton(this.target.joinQueryList[joinIndex].aggAdd);\r\n  }\r\n\r\n  handleJoinAggPartEvent(part, joinIndex, expIndex, event) {\r\n    console.log(\"handleJoinAggPartEvent\", event);\r\n    if (event.name === \"get-param-options\" && event.param.name === \"agg\") {\r\n      // 暂时只支持展开操作符列表\r\n      const operators = event.param.options;\r\n      return Promise.resolve(this.uiSegmentSrv.newOperators(operators));\r\n    } else if (event.name === \"get-part-actions\") {\r\n      return this.$q.when([{ text: 'Remove', value: 'remove' }]);\r\n    } else if (event.name === \"action\" && event.action.value === \"remove\") {\r\n      this.target.joinQueryList[joinIndex].aggs.splice(expIndex, 1);\r\n      this.updateRestSql()\r\n    } else if (event.name === \"part-param-changed\") {\r\n      this.updateRestSql();\r\n    } else {\r\n      return Promise.resolve([]);\r\n    }\r\n  }\r\n\r\n  addGroupAction() {\r\n    const express = sqlPart.create({ type: 'column', params: ['column'] });\r\n    console.log(\"addGroupsAction\", express);\r\n    this.target.groupParts.push(express);\r\n    this.resetPlusButton(this.groupAdd);\r\n  }\r\n\r\n  handleGroupPartEvent(part, index, event) {\r\n    console.log(\"handleGroupsPartEvent\");\r\n    if (event.name === \"get-part-actions\") {\r\n      return this.$q.when([{ text: 'Remove', value: 'remove' }]);\r\n    } else if (event.name === \"action\" && event.action.value === \"remove\") {\r\n      this.target.groupParts.splice(index, 1);\r\n      this.updateRestSql()\r\n    } else if (event.name === \"part-param-changed\") {\r\n      this.updateRestSql();\r\n    }\r\n  }\r\n\r\n  addJoinGroupAction(part, joinIndex, expIndex) {\r\n    const express = sqlPart.create({ type: 'column', params: ['column'] });\r\n    console.log(\"addGroupsAction\", express);\r\n    this.target.joinQueryList[joinIndex].groups.push(express);\r\n    this.resetPlusButton(this.target.joinQueryList[joinIndex].groupAdd);\r\n  }\r\n\r\n  handleJoinGroupPartEvent(part, joinIndex, expIndex, event) {\r\n    console.log(\"handleJoinGroupPartEvent\");\r\n    if (event.name === \"get-part-actions\") {\r\n      return this.$q.when([{ text: 'Remove', value: 'remove' }]);\r\n    } else if (event.name === \"action\" && event.action.value === \"remove\") {\r\n      this.target.joinQueryList[joinIndex].groups.splice(expIndex, 1);\r\n      this.updateRestSql();\r\n    } else if (event.name === \"part-param-changed\") {\r\n      this.updateRestSql();\r\n    }\r\n  }\r\n\r\n  addJoinOnAction(part, joinIndex, expIndex) {\r\n    const express = sqlPart.create({ type: 'on', params: ['field', 'field'] });\r\n    console.log(\"addJoinOnAction\", express);\r\n    this.target.joinQueryList[joinIndex].on.push(express);\r\n    this.resetPlusButton(this.target.joinQueryList[joinIndex].onAdd);\r\n  }\r\n\r\n  handleJoinOnPartEvent(part, joinIndex, expIndex, event) {\r\n    console.log(\"handleJoinOnPartEvent\", event);\r\n    if (event.name === \"get-param-options\" && event.param.name === \"op\") {\r\n      // 暂时只支持展开操作符列表\r\n      const operators = ['='];\r\n      return Promise.resolve(this.uiSegmentSrv.newOperators(operators));\r\n    } else if (event.name === \"get-part-actions\") {\r\n      return this.$q.when([{ text: 'Remove', value: 'remove' }]);\r\n    } else if (event.name === \"action\" && event.action.value === \"remove\") {\r\n      this.target.joinQueryList[joinIndex].on.splice(expIndex, 1);\r\n    } else if (event.name === \"get-param-options\" && event.param.name === \"field1\") {\r\n      // on field1=field2，field1是join的表中的字段，field2是原始表中的字段，这里做成可选项\r\n      console.log(\"handleJoinOnPartEvent\", this.target.joinQueryList[joinIndex]);\r\n      const options = [];\r\n      this.target.joinQueryList[joinIndex].selections.forEach((part) => {\r\n        options.push(part[\"params\"][0]);\r\n      });\r\n      return Promise.resolve(this.uiSegmentSrv.newOperators(options));\r\n    } else if (event.name === \"get-param-options\" && event.param.name === \"field2\") {\r\n      const options = [];\r\n      this.target.selectionsParts.forEach((part) => {\r\n        options.push(part[\"params\"][0]);\r\n      });\r\n      return Promise.resolve(this.uiSegmentSrv.newOperators(options));\r\n    } else if (event.name === \"part-param-changed\") {\r\n      this.updateRestSql();\r\n    } else {\r\n      return Promise.resolve([]);\r\n    }\r\n  }\r\n\r\n  addJoinExportAction(part, joinIndex, expIndex) {\r\n    const express = sqlPart.create({ type: 'alias', params: ['fields', 'alias'] });\r\n    console.log(\"addJoinOnAction\", express);\r\n    this.target.joinQueryList[joinIndex].export.push(express);\r\n    this.resetPlusButton(this.target.joinQueryList[joinIndex].exportAdd);\r\n  }\r\n  onJoinLimitChanged(joinIndex) {\r\n    this.target.joinQueryList[joinIndex].limit = this.target.joinQueryList[joinIndex].limit.value;\r\n    this.updateRestSql();\r\n  }\r\n\r\n  handleJoinExportPartEvent(part, joinIndex, expIndex, event) {\r\n    console.log(\"handleJoinExportPartEvent\", event);\r\n    if (event.name === \"get-part-actions\") {\r\n      return this.$q.when([{ text: 'Remove', value: 'remove' }]);\r\n    } else if (event.name === \"action\" && event.action.value === \"remove\") {\r\n      this.target.joinQueryList[joinIndex].export.splice(expIndex, 1);\r\n      this.updateRestSql();\r\n    } else if (event.name === \"get-param-options\" && event.param.name === \"field\") {\r\n      const options = this.getExportOptions(this.target.joinQueryList[joinIndex].selections, this.target.joinQueryList[joinIndex].aggs);\r\n      return Promise.resolve(this.uiSegmentSrv.newOperators(options));\r\n    } else if (event.name === \"part-param-changed\") {\r\n      this.updateRestSql();\r\n    } else {\r\n      return Promise.resolve([]);\r\n    }\r\n  }\r\n\r\n  addSortAction(index) {\r\n    const express = sqlPart.create({ type: 'sort', params: ['asc', 'field'] });\r\n    console.log(\"addSortAction\", index);\r\n    this.target.sortParts.push(express);\r\n    this.resetPlusButton(this.sortAdd);\r\n  }\r\n\r\n  handleSortPartEvent(part, index, event) {\r\n    console.log(\"handleSortPartEvent\", event);\r\n    if (event.name === \"get-part-actions\") {\r\n      return this.$q.when([{ text: 'Remove', value: 'remove' }]);\r\n    } else if (event.name === \"action\" && event.action.value === \"remove\") {\r\n      // console.log(this.target.sortParts,'====');\r\n\r\n      this.target.sortParts.splice(index, 1);\r\n      this.updateRestSql();\r\n      // console.log(this.target.sortParts,'====');\r\n    } else if (event.name === \"get-param-options\" && event.param.name === \"field\") {\r\n      return Promise.resolve(this.uiSegmentSrv.newOperators(this.getAllFields()));\r\n    } else if (event.name === \"part-param-changed\") {\r\n      this.updateRestSql();\r\n    } else {\r\n      return Promise.resolve([]);\r\n    }\r\n  }\r\n\r\n  addFieldAction(index) {\r\n    const express = sqlPart.create({ type: 'alias', params: ['fields', 'alias'] });\r\n    console.log(\"addSortAction\", index, express);\r\n    this.target.fieldParts.push(express);\r\n    this.resetPlusButton(this.fieldAdd);\r\n  }\r\n\r\n  handleFieldPartEvent(part, index, event) {\r\n    // console.log(\"handleFieldPartEvent\", event);\r\n    if (event.name === \"get-part-actions\") {\r\n      return this.$q.when([{ text: 'Remove', value: 'remove' }]);\r\n    } else if (event.name === \"action\" && event.action.value === \"remove\") {\r\n\r\n      this.target.fieldParts.splice(index, 1);\r\n      this.updateRestSql();\r\n\r\n    } else if (event.name === \"get-param-options\") {\r\n      return Promise.resolve(this.uiSegmentSrv.newOperators(this.getAllFields()));\r\n    } else if (event.name === \"part-param-changed\") {\r\n      this.updateRestSql();\r\n    } else {\r\n      return Promise.resolve([]);\r\n    }\r\n  }\r\n\r\n  resetPlusButton(button) {\r\n    const plusButton = this.uiSegmentSrv.newPlusButton();\r\n    button.html = plusButton.html;\r\n    button.value = plusButton.value;\r\n  }\r\n\r\n  addJoin() {\r\n    const queryObj = {\r\n      type: \"left_join\",\r\n      table: this.uiSegmentSrv.newSegment({ \"value\": \"select table\", \"fake\": true }),\r\n      selections: [],\r\n      selectionAdd: this.uiSegmentSrv.newPlusButton(),\r\n      where: [],\r\n      whereAdd: this.uiSegmentSrv.newPlusButton(),\r\n      aggs: [],\r\n      aggAdd: this.uiSegmentSrv.newPlusButton(),\r\n      groups: [],\r\n      groupAdd: this.uiSegmentSrv.newPlusButton(),\r\n      on: [],\r\n      onAdd: this.uiSegmentSrv.newPlusButton(),\r\n      export: [],\r\n      exportAdd: this.uiSegmentSrv.newPlusButton(),\r\n      limit: this.uiSegmentSrv.newSegment({ \"value\": '1000', \"fake\": true }),\r\n    };\r\n    this.target.joinQueryList.push(queryObj);\r\n    console.log(\"addJoin\", this.target.joinQueryList);\r\n  }\r\n  delJoin(index) {\r\n    this.target.joinQueryList.splice(index, 1)\r\n  }\r\n\r\n  getAllFields() {\r\n    // 获取select的字段，aggregate的字段，以及所有join表中的export字段\r\n\r\n    const mainFields = this.getExportOptions(this.target.selectionsParts, this.target.aggParts);\r\n    const exportFields = []\r\n    this.target.joinQueryList.forEach((query) => {\r\n      console.log(\"fafadsf1\", query.export)\r\n      query.export.forEach((part) => {\r\n        console.log(\"fafadsf2\", part);\r\n        exportFields.push(part.params[1]) // todo: 重复元素保护\r\n      });\r\n    });\r\n    return mainFields.concat(exportFields)\r\n  }\r\n\r\n  getExportOptions(selections, aggs) {\r\n    // 获取select的字段和aggs的字段并格式化为restSql格式\r\n    const options = [];\r\n    selections.forEach((part) => {\r\n      // export已经select的字段\r\n      options.push(part[\"params\"][0]);\r\n    });\r\n    aggs.forEach((part) => {\r\n      // export已经aggregation的字段\r\n      console.log(\"handleJoinExportPartEvent\", part);\r\n      const [aggFunc, field] = part.params;\r\n      options.push([field, aggFunc].join(\",\"));\r\n      // options.push([field, aggFunc].join(\"__\"));\r\n    });\r\n    return options;\r\n  }\r\n\r\n  updateRestSql() {\r\n    // console.log('🎭', this.target);\r\n    // 将输入的内容更新到target中去\r\n    this.target.query = {\r\n      // restSql协议结构定义\r\n      \"select\": {\r\n        \"from\": \"\",\r\n        \"fields\": [],\r\n        \"filter\": {},\r\n        \"group_by\": [],\r\n        \"aggregation\": [],\r\n        \"sort\": [],\r\n      },\r\n      \"join\": [],\r\n      \"sort\": [],\r\n      \"fields\": [],\r\n      \"limit\": 200\r\n    };\r\n\r\n    // udpate table\r\n    this.target.query.select.from = this.target.table;\r\n   \r\n    // update queryLimit\r\n    this.target.query.select.limit = parseInt(this.target.queryLimit);\r\n\r\n    // update select fields\r\n    this.target.selectionsParts.forEach((part) => {\r\n      this.target.query.select.fields.push(part.params[0]);\r\n    });\r\n    // update where\r\n    const operatorToSuffix = {\r\n      \"=\": \"\",\r\n      \"<\": \"__lt\",\r\n      \"<=\": \"__lte\",\r\n      \">\": \"__gt\",\r\n      \">=\": \"__gte\",\r\n      \"CONTAINS\": \"__contains\",\r\n      \"STARTSWITH\": \"__startswith\",\r\n      \"ENDSWITH\": \"__endswith\",\r\n      \"RANGE\": \"__range\",\r\n      \"IN\": \"__in\"\r\n    }\r\n    // [\"1\", \"=\", \"1\"]\r\n    this.target.whereParts.forEach((part) => {\r\n      // console.log('🎭',part);\r\n      const suffix = operatorToSuffix[part.params[1]];\r\n      const key = `${part.params[0]}${suffix}`\r\n      if (part.params[1] === \"IN\") {\r\n        // console.log(\"whereTest\", part.params[2], typeof part.params[2]);\r\n        this.target.query.select.filter[key] = JSON.parse(part.params[2]);\r\n\r\n      } else {\r\n        if ((part.params[2].startsWith(\"\\\"\") && part.params[2].endsWith(\"\\\"\")) || (part.params[2].startsWith(\"\\'\") && part.params[2].endsWith(\"\\'\"))) {\r\n          const tmpStr = part.params[2]\r\n          this.target.query.select.filter[key] = tmpStr.slice(1, tmpStr.length - 1);\r\n          // console.log(this.target.query.select);\r\n        } else if (!isNaN(parseFloat(part.params[2]))) {\r\n          this.target.query.select.filter[key] = parseFloat(part.params[2]);\r\n          console.log( this.target.query.select.filter);\r\n        }\r\n        else if (Object.keys(this.varables).indexOf(part.params[2] )) {\r\n          this.target.query.select.filter[key] = part.params[2]\r\n        }\r\n        else if (part.params[2].toLowerCase() === \"true\") {\r\n          this.target.query.select.filter[key] = true;\r\n        } else if (part.params[2].toLowerCase() === \"false\") {\r\n          this.target.query.select.filter[key] = false;\r\n        }\r\n        else {\r\n          return Promise.reject({\r\n            message: 'tetete',\r\n          });\r\n        }\r\n      }\r\n    });\r\n\r\n    // update aggregation\r\n    // todo:agg func无法修改, 无法删除\r\n    this.target.aggParts.forEach((part) => {\r\n      \r\n      const [aggFunc, field] = part.params;\r\n \r\n      \r\n      \r\n      this.target.query.select.aggregation.push([field, aggFunc].join(\"__\"));\r\n    });\r\n\r\n    // update group by\r\n    this.target.groupParts.forEach((part) => {\r\n      console.log(\"groupParts\", part);\r\n      this.target.query.select.group_by.push(part.params[0]);\r\n    });\r\n\r\n    // update join\r\n    this.target.joinQueryList.forEach((query) => {\r\n      console.log(\"joinQueryList\", query);\r\n      const joinQuery = {};\r\n      // update join type\r\n      joinQuery.type = query.type;\r\n      joinQuery.query = { \"select\": {} };\r\n      console.log(\"joinQueryList\", query);\r\n      // update join table\r\n      joinQuery.query.select.from = query.table.value;\r\n      console.log(\"joinQueryList\", joinQuery.query.select.from);\r\n      // update join fields\r\n      joinQuery.query.select.fields = []\r\n      query.selections.forEach((part) => {\r\n        console.log(\"selections\", part);\r\n        joinQuery.query.select.fields.push(part.params[0]);\r\n      });\r\n      // udpate join filter\r\n      joinQuery.query.select.filter = {};\r\n      query.where.forEach((part) => {\r\n        const suffix = operatorToSuffix[part.params[1]];\r\n        const key = `${part.params[0]}${suffix}`;\r\n\r\n        if (part.params[1] === \"IN\") {\r\n          console.log(\"whereTest\", part.params[2], typeof part.params[2]);\r\n          joinQuery.query.select.filter[key] = JSON.parse(part.params[2]);\r\n        } else {\r\n          console.log(\"whereTest\", part.params[2]);\r\n          if ((part.params[2].startsWith(\"\\\"\") && part.params[2].endsWith(\"\\\"\")) || (part.params[2].startsWith(\"\\'\") && part.params[2].endsWith(\"\\'\"))) {\r\n            const tmpStr = part.params[2]\r\n            joinQuery.query.select.filter[key] = tmpStr.slice(1, tmpStr.length - 1);\r\n          } else if (!isNaN(parseFloat(part.params[2]))) {\r\n            joinQuery.query.select.filter[key] = parseFloat(part.params[2]);\r\n          } else {\r\n            return Promise.reject({\r\n              message: 'tetete',\r\n            });\r\n          }\r\n\r\n        }\r\n\r\n        console.log(\"joinfilter\", key, joinQuery.query.select.filter);\r\n      })\r\n      // update aggregation \r\n      // todo:agg func无法修改\r\n      joinQuery.query.select.aggregation = [];\r\n      query.aggs.forEach((part) => {\r\n        console.log(\"join_aggregation\", part);\r\n        const [aggFunc, field] = part.params;\r\n        // joinQuery.query.select.aggregation.push([field, aggFunc].join(\",\"));\r\n        joinQuery.query.select.aggregation.push([field, aggFunc].join(\"__\"));\r\n      });\r\n      // update join group by\r\n      joinQuery.query.select.group_by = [];\r\n      query.groups.forEach((part) => {\r\n        // console.log(\"join_group\", part);\r\n        joinQuery.query.select.group_by.push(part.params[0]);\r\n      });\r\n      // update join on\r\n      joinQuery.on = {};\r\n      query.on.forEach((part) => {\r\n        joinQuery.on[part.params[0]] = part.params[1];\r\n      });\r\n      // updaate export\r\n      joinQuery.export = [];\r\n      query.export.forEach((part) => {\r\n        console.log(\"joinQuery\");\r\n        joinQuery.export.push(part.params.join(\"@\"));\r\n      });\r\n      // update joinLimit\r\n      joinQuery.limit = parseInt(query.limit.value);\r\n      this.target.query.join.push(joinQuery);\r\n    });\r\n\r\n    // update sort\r\n    this.target.sortParts.forEach((part) => {\r\n      console.log(\"sortParts\", part);\r\n      const sortExp = part.params[0] === \"asc\" ? part.params[1] : `-${part.params[1]}`;\r\n      this.target.query.sort.push(sortExp);\r\n    });\r\n\r\n    //update fields\r\n    this.target.fieldParts.forEach((part) => {\r\n      console.log(\"fieldParts\", part.params, '5555555555');\r\n     \r\n      this.target.query.fields.push(part.params.join(\"@\"));\r\n    });\r\n\r\n    // update limit\r\n    this.target.query.limit = parseInt(this.target.limit);\r\n    // console.log(\"UpdateComplete\", this.target.query);\r\n    // this.datasource.metricFindQuery(this.target.query || '').then(this.panelCtrl.refresh());\r\n    // console.log(this.target, this.target.query);\r\n    this.target.target = JSON.stringify(this.target.query);\r\n    // this.target.target.push(this.target.query)\r\n    // this.target.target = this.target.query;\r\n\r\n    // console.log(this.target, this.target.query);\r\n\r\n    // this.target.whereParts = this.tasrget.whereParts;\r\n\r\n   \r\n    // this.datasource.metricFindQuery(JSON.stringify(this.target.query) || '');\r\n    // this.datasource.query(this.target.query);\r\n    this.panelCtrl.refresh();\r\n\r\n  }\r\n}\r\nGenericDatasourceQueryCtrl.templateUrl = 'partials/query.editor.html';\r\n\r\n"]}