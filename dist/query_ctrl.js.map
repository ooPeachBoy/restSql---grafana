{"version":3,"sources":["../src/query_ctrl.js"],"names":["GenericDatasourceQueryCtrl","$scope","$injector","uiSegmentSrv","scope","formats","text","value","types","target","type","tableSegment","newSegment","table","selectionsParts","selectionAdd","newPlusButton","whereParts","whereAdd","aggParts","aggAdd","groupParts","groupAdd","joinQueryList","sortParts","sortAdd","fieldParts","fieldAdd","limitSegment","limit","query","options","push","console","log","Promise","resolve","selectParts","$item","$subItem","parts","part","index","_","indexOf","splice","updateRestSql","joinIndex","getOptions","express","sqlPart","create","params","resetPlusButton","event","name","action","removePart","forEach","item","i","expIndex","selections","param","operators","newOperators","where","aggs","groups","on","onAdd","export","exportAdd","getExportOptions","getAllFields","button","plusButton","html","queryObj","mainFields","exportFields","concat","aggFunc","field","join","select","from","fields","operatorToSuffix","suffix","key","filter","JSON","parse","startsWith","endsWith","tmpStr","slice","length","isNaN","parseFloat","toLowerCase","reject","message","aggregation","group_by","joinQuery","sortExp","sort","parseInt","stringify","panelCtrl","refresh","QueryCtrl","templateUrl"],"mappings":"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","file":"query_ctrl.js","sourcesContent":["import './css/query-editor.css!'\n\nimport _ from 'lodash';\nimport { QueryCtrl } from 'app/plugins/sdk';\nimport sqlPart from './sql_part';\n\nexport class GenericDatasourceQueryCtrl extends QueryCtrl {\n\n  constructor($scope, $injector, uiSegmentSrv) {\n    super($scope, $injector);\n    // console.log(\"GenericDatasourceQueryCtrl\", uiSegmentSrv);\n    this.scope = $scope;\n    this.uiSegmentSrv = uiSegmentSrv\n\n\n    this.formats = [\n      { text: 'Time series', value: 'grafana.timeserie' },\n      { text: 'Table', value: 'grafana.table' },\n    ];\n    this.types = [\n      { text: 'Left Join', value: 'left_join' },\n      { text: 'Inner Join', value: 'inner_join' },\n      { text: 'Full Join', value: 'full_join' }\n    ];\n    \n\n    // this.target.tableSegment = null;\n    this.target.target = this.target.target || 'targettest';\n    this.target.type = this.target.type;\n\n    this.target.tableSegment = this.uiSegmentSrv.newSegment({ \"value\": this.target.table||'select table', \"fake\": true });\n    this.target.table = this.target.table || this.target.tableSegment.value;\n    this.target.selectionsParts = this.target.selectionsParts|| [];\n    this.selectionAdd = this.uiSegmentSrv.newPlusButton();    \n\n    this.target.whereParts = this.target.whereParts|| [];\n    this.whereAdd = this.uiSegmentSrv.newPlusButton();\n\n    this.target.aggParts = this.target.aggParts|| [];\n    this.aggAdd = this.uiSegmentSrv.newPlusButton();\n\n    this.target.groupParts = this.target.groupParts|| [];\n    this.groupAdd = this.uiSegmentSrv.newPlusButton();\n\n    this.target.joinQueryList = this.target.joinQueryList|| [];\n\n    this.target.sortParts = this.target.sortParts|| [];\n    this.sortAdd = this.uiSegmentSrv.newPlusButton();\n\n    this.target.fieldParts = this.target.fieldParts|| [];\n    this.fieldAdd = this.uiSegmentSrv.newPlusButton();\n\n    this.target.limitSegment = this.uiSegmentSrv.newSegment({ \"value\": this.target.limit||'1000', \"fake\": true });\n    this.target.limit = this.target.limitSegment.value||'1000';\n    this.target.query = {\n      // restSql协议结构定义\n      \"select\": {\n        \"from\": \"\",\n        \"filter\": {},\n        \"group_by\": [],\n        \"aggregation\": [],\n        \"sort\": [],\n      },\n      \"join\": [],\n      \"sort\": [],\n      \"fields\": [],\n      \"limit\": 200\n    };\n\n  }\n \n  getOptions() {\n    const options = [];\n    options.push(this.uiSegmentSrv.newSegment({ type: 'expression', value: 'Expression' }));\n    console.log(\"tttttt getOptions\", options);\n    return Promise.resolve(options);\n  }\n  addSelectPart(selectParts, $item, $subItem) {\n    console.log(selectParts, $item, $subItem,'0000');\n  }\n\n  removePart(parts, part) {\n    const index = _.indexOf(parts, part);\n    parts.splice(index, 1);\n  }\n\n  onFormatChanged() {\n    console.log(\"onFormatChanged\", this);\n    this.updateRestSql();\n  }\n\n  onTableChanged() {\n    console.log(\"tableChanged\", this);\n    this.target.table = this.target.tableSegment.value;\n    this.updateRestSql();\n  }\n\n  onJoinTableChanged(joinIndex) {\n    console.log(\"onJoinTableChanged\", joinIndex);\n    // this.target.joinQueryList[joinIndex].table = ;\n    this.updateRestSql();\n  }\n\n  onLimitChanged() {\n    // console.log(\"onLimitChanged\");\n    this.target.limit = this.target.limitSegment.value;\n    this.updateRestSql();\n  }\n\n  addSelectionAction(part, index) {\n    console.log(1111, part,index);\n    this.getOptions()\n    const express = sqlPart.create({ type: 'column', params: ['column'] });\n    this.target.selectionsParts.push(express);\n    this.resetPlusButton(this.selectionAdd);\n\n  }\n\n  handleSelectionsPartEvent(part, index, event) {\n    console.log(\"tttttt handleSelectionsPartEvent\", event, index, part, '---');\n    if (event.name === \"get-part-actions\") {\n      return Promise.resolve([{ text: 'Remove', value: 'remove' }]);\n    } else if (event.name === \"action\" && event.action.value === \"remove\") {\n      this.removePart(this.target.selectionsParts, part);\n      // this.target.selectionsParts.splice(index, 1, null);\n      this.updateRestSql()\n      console.log(this.target.selectionsParts, '------')\n    } else if (event.name === \"part-param-changed\") {\n      console.log(this.target.selectionsParts);\n      this.target.selectionsParts.forEach((item, i) => {\n      })\n      this.updateRestSql();\n    }\n  }\n\n  addJoinSelectionAction(joinIndex, expIndex) {\n    console.log(\"addJoinSelectionAction\", joinIndex, expIndex);\n    const express = sqlPart.create({ type: 'column', params: ['column'] });\n    this.target.joinQueryList[joinIndex].selections.push(express)\n    this.resetPlusButton(this.target.joinQueryList[joinIndex].selectionAdd);\n  }\n\n  handleJoinSelectionsPartEvent(part, joinIndex, expIndex, event) {\n    console.log(\"handleJoinSelectionsPartEvent\", joinIndex, expIndex);\n    if (event.name === \"get-part-actions\") {\n      return Promise.resolve([{ text: 'Remove', value: 'remove' }]);\n    } else if (event.name === \"action\" && event.action.value === \"remove\") {\n      // this.removePart(this.target.joinQueryList[joinIndex].selections, part);\n      this.target.joinQueryList[joinIndex].selections.splice(expIndex, 1);\n      this.updateRestSql()\n    } else if (event.name === \"part-param-changed\") {\n      this.updateRestSql();\n    }\n  }\n\n  addWhereAction(part, index) {\n    const express = sqlPart.create({ type: 'expression', params: ['column', '=', 'value'] });\n    // console.log(\"addWhereAction\", express);\n    this.target.whereParts.push(express);\n  \n    this.resetPlusButton(this.whereAdd);\n  }\n\n  handleWherePartEvent(part, index, event) {\n    // console.log(\"handleWherePartEvent\", event);\n    if (event.name === \"get-param-options\" && event.param.name === \"op\") {\n      // 暂时只支持展开操作符列表\n      const operators = ['=', '<', '<=', '>', '>=', 'CONTAINS', 'STARTSWITH', 'ENDSWITH', 'RANGE', 'IN'];\n      return Promise.resolve(this.uiSegmentSrv.newOperators(operators));\n    } else if (event.name === \"get-part-actions\") {\n      return Promise.resolve([{ text: 'Remove', value: 'remove' }]);\n    } else if (event.name === \"action\" && event.action.value === \"remove\") {\n      this.target.whereParts.splice(index, 1);\n      this.updateRestSql()\n    } else if (event.name === \"part-param-changed\") {\n      this.updateRestSql();\n    } else {\n      return Promise.resolve([]);\n    }\n  }\n\n  addJoinWhereAction(joinIndex, expIndex) {\n    const express = sqlPart.create({ type: 'expression', params: ['column', '=', 'value'] });\n    console.log(\"addWhereAction\", express);\n    this.target.joinQueryList[joinIndex].where.push(express);\n    this.resetPlusButton(this.target.joinQueryList[joinIndex].whereAdd);\n  }\n\n  handleJoinWherePartEvent(part, joinIndex, expIndex, event) {\n    console.log(\"handleJoinWherePartEvent\", event);\n    if (event.name === \"get-param-options\" && event.param.name === \"op\") {\n      // 暂时只支持展开操作符列表\n      const operators = ['=', '<', '<=', '>', '>=', 'CONTAINS', 'STARTSWITH', 'ENDSWITH', 'RANGE', 'IN'];\n      return Promise.resolve(this.uiSegmentSrv.newOperators(operators));\n    } else if (event.name === \"get-part-actions\") {\n      return Promise.resolve([{ text: 'Remove', value: 'remove' }]);\n    } else if (event.name === \"action\" && event.action.value === \"remove\") {\n      this.target.joinQueryList[joinIndex].where.splice(expIndex, 1);\n    } else if (event.name === \"part-param-changed\") {\n      this.updateRestSql();\n    } else {\n      return Promise.resolve([]);\n    }\n  }\n\n  addAggAction() {\n    const express = sqlPart.create({ type: 'aggregate', params: ['avg', 'column'] });\n    console.log(\"addAggAction\", express);\n    this.target.aggParts.push(express);\n    this.resetPlusButton(this.aggAdd);\n  }\n\n  handleAggPartEvent(part, index, event) {\n    console.log(\"handleAggPartEvent\");\n    if (event.name === \"get-param-options\" && event.param.name === \"agg\") {\n      // 暂时只支持展开操作符列表\n      const operators = event.param.options;\n      return Promise.resolve(this.uiSegmentSrv.newOperators(operators));\n    } else if (event.name === \"get-part-actions\") {\n      return Promise.resolve([{ text: 'Remove', value: 'remove' }]);\n    } else if (event.name === \"action\" && event.action.value === \"remove\") {\n      this.target.aggParts.splice(index, 1)\n      this.updateRestSql()\n    } else if (event.name === \"part-param-changed\") {\n      this.updateRestSql();\n    } else {\n      return Promise.resolve([]);\n    }\n  }\n\n  addJoinAggAction(joinIndex) {\n    const express = sqlPart.create({ type: 'aggregate', params: ['avg', 'column'] });\n    console.log(\"addJoinAggAction\", express);\n    this.target.joinQueryList[joinIndex].aggs.push(express);\n    this.resetPlusButton(this.target.joinQueryList[joinIndex].aggAdd);\n  }\n\n  handleJoinAggPartEvent(part, joinIndex, expIndex, event) {\n    console.log(\"handleJoinAggPartEvent\", event);\n    if (event.name === \"get-param-options\" && event.param.name === \"agg\") {\n      // 暂时只支持展开操作符列表\n      const operators = event.param.options;\n      return Promise.resolve(this.uiSegmentSrv.newOperators(operators));\n    } else if (event.name === \"get-part-actions\") {\n      return Promise.resolve([{ text: 'Remove', value: 'remove' }]);\n    } else if (event.name === \"action\" && event.action.value === \"remove\") {\n      this.target.joinQueryList[joinIndex].aggs.splice(expIndex, 1);\n      this.updateRestSql()\n    } else if (event.name === \"part-param-changed\") {\n      this.updateRestSql();\n    } else {\n      return Promise.resolve([]);\n    }\n  }\n\n  addGroupAction() {\n    const express = sqlPart.create({ type: 'column', params: ['column'] });\n    console.log(\"addGroupsAction\", express);\n    this.target.groupParts.push(express);\n    this.resetPlusButton(this.groupAdd);\n  }\n\n  handleGroupPartEvent(part, index, event) {\n    console.log(\"handleGroupsPartEvent\");\n    if (event.name === \"get-part-actions\") {\n      return Promise.resolve([{ text: 'Remove', value: 'remove' }]);\n    } else if (event.name === \"action\" && event.action.value === \"remove\") {\n      this.target.groupParts.splice(index, 1);\n      this.updateRestSql()\n    } else if (event.name === \"part-param-changed\") {\n      this.updateRestSql();\n    }\n  }\n\n  addJoinGroupAction(part, joinIndex, expIndex) {\n    const express = sqlPart.create({ type: 'column', params: ['column'] });\n    console.log(\"addGroupsAction\", express);\n    this.target.joinQueryList[joinIndex].groups.push(express);\n    this.resetPlusButton(this.target.joinQueryList[joinIndex].groupAdd);\n  }\n\n  handleJoinGroupPartEvent(part, joinIndex, expIndex, event) {\n    console.log(\"handleJoinGroupPartEvent\");\n    if (event.name === \"get-part-actions\") {\n      return Promise.resolve([{ text: 'Remove', value: 'remove' }]);\n    } else if (event.name === \"action\" && event.action.value === \"remove\") {\n      this.target.joinQueryList[joinIndex].groups.splice(expIndex, 1);\n      this.updateRestSql();\n    } else if (event.name === \"part-param-changed\") {\n      this.updateRestSql();\n    }\n  }\n\n  addJoinOnAction(part, joinIndex, expIndex) {\n    const express = sqlPart.create({ type: 'on', params: ['field', 'field'] });\n    console.log(\"addJoinOnAction\", express);\n    this.target.joinQueryList[joinIndex].on.push(express);\n    this.resetPlusButton(this.target.joinQueryList[joinIndex].onAdd);\n  }\n\n  handleJoinOnPartEvent(part, joinIndex, expIndex, event) {\n    console.log(\"handleJoinOnPartEvent\", event);\n    if (event.name === \"get-param-options\" && event.param.name === \"op\") {\n      // 暂时只支持展开操作符列表\n      const operators = ['='];\n      return Promise.resolve(this.uiSegmentSrv.newOperators(operators));\n    } else if (event.name === \"get-part-actions\") {\n      return Promise.resolve([{ text: 'Remove', value: 'remove' }]);\n    } else if (event.name === \"action\" && event.action.value === \"remove\") {\n      this.target.joinQueryList[joinIndex].on.splice(expIndex, 1);\n    } else if (event.name === \"get-param-options\" && event.param.name === \"field1\") {\n      // on field1=field2，field1是join的表中的字段，field2是原始表中的字段，这里做成可选项\n      console.log(\"handleJoinOnPartEvent\", this.target.joinQueryList[joinIndex]);\n      const options = [];\n      this.target.joinQueryList[joinIndex].selections.forEach((part) => {\n        options.push(part[\"params\"][0]);\n      });\n      return Promise.resolve(this.uiSegmentSrv.newOperators(options));\n    } else if (event.name === \"get-param-options\" && event.param.name === \"field2\") {\n      const options = [];\n      this.target.selectionsParts.forEach((part) => {\n        options.push(part[\"params\"][0]);\n      });\n      return Promise.resolve(this.uiSegmentSrv.newOperators(options));\n    } else if (event.name === \"part-param-changed\") {\n      this.updateRestSql();\n    } else {\n      return Promise.resolve([]);\n    }\n  }\n\n  addJoinExportAction(part, joinIndex, expIndex) {\n    const express = sqlPart.create({ type: 'alias', params: ['fields', 'alias'] });\n    console.log(\"addJoinOnAction\", express);\n    this.target.joinQueryList[joinIndex].export.push(express);\n    this.resetPlusButton(this.target.joinQueryList[joinIndex].exportAdd);\n  }\n\n  handleJoinExportPartEvent(part, joinIndex, expIndex, event) {\n    console.log(\"handleJoinExportPartEvent\", event);\n    if (event.name === \"get-part-actions\") {\n      return Promise.resolve([{ text: 'Remove', value: 'remove' }]);\n    } else if (event.name === \"action\" && event.action.value === \"remove\") {\n      this.target.joinQueryList[joinIndex].export.splice(expIndex, 1);\n      this.updateRestSql();\n    } else if (event.name === \"get-param-options\" && event.param.name === \"field\") {\n      const options = this.getExportOptions(this.target.joinQueryList[joinIndex].selections, this.target.joinQueryList[joinIndex].aggs);\n      return Promise.resolve(this.uiSegmentSrv.newOperators(options));\n    } else if (event.name === \"part-param-changed\") {\n      this.updateRestSql();\n    } else {\n      return Promise.resolve([]);\n    }\n  }\n\n  addSortAction(index) {\n    const express = sqlPart.create({ type: 'sort', params: ['asc', 'field'] });\n    console.log(\"addSortAction\", index);\n    this.target.sortParts.push(express);\n    this.resetPlusButton(this.sortAdd);\n  }\n\n  handleSortPartEvent(part, index, event) {\n    console.log(\"handleSortPartEvent\", event);\n    if (event.name === \"get-part-actions\") {\n      return Promise.resolve([{ text: 'Remove', value: 'remove' }]);\n    } else if (event.name === \"action\" && event.action.value === \"remove\") {\n      // console.log(this.target.sortParts,'====');\n\n      this.target.sortParts.splice(index, 1);\n      this.updateRestSql();\n      // console.log(this.target.sortParts,'====');\n    } else if (event.name === \"get-param-options\" && event.param.name === \"field\") {\n      return Promise.resolve(this.uiSegmentSrv.newOperators(this.getAllFields()));\n    } else if (event.name === \"part-param-changed\") {\n      this.updateRestSql();\n    } else {\n      return Promise.resolve([]);\n    }\n  }\n\n  addFieldAction(index) {\n    const express = sqlPart.create({ type: 'alias', params: ['fields', 'alias'] });\n    console.log(\"addSortAction\", index);\n    this.target.fieldParts.push(express);\n    this.resetPlusButton(this.fieldAdd);\n  }\n\n  handleFieldPartEvent(part, index, event) {\n    console.log(\"handleFieldPartEvent\", event);\n    if (event.name === \"get-part-actions\") {\n      return Promise.resolve([{ text: 'Remove', value: 'remove' }]);\n    } else if (event.name === \"action\" && event.action.value === \"remove\") {\n\n      this.target.fieldParts.splice(index, 1);\n      this.updateRestSql();\n\n    } else if (event.name === \"get-param-options\") {\n      return Promise.resolve(this.uiSegmentSrv.newOperators(this.getAllFields()));\n    } else if (event.name === \"part-param-changed\") {\n      this.updateRestSql();\n    } else {\n      return Promise.resolve([]);\n    }\n  }\n\n  resetPlusButton(button) {\n    const plusButton = this.uiSegmentSrv.newPlusButton();\n    button.html = plusButton.html;\n    button.value = plusButton.value;\n  }\n\n  addJoin() {\n    const queryObj = {\n      type: \"left_join\",\n      table: this.uiSegmentSrv.newSegment({ \"value\": \"select table\", \"fake\": true }),\n      selections: [],\n      selectionAdd: this.uiSegmentSrv.newPlusButton(),\n      where: [],\n      whereAdd: this.uiSegmentSrv.newPlusButton(),\n      aggs: [],\n      aggAdd: this.uiSegmentSrv.newPlusButton(),\n      groups: [],\n      groupAdd: this.uiSegmentSrv.newPlusButton(),\n      on: [],\n      onAdd: this.uiSegmentSrv.newPlusButton(),\n      export: [],\n      exportAdd: this.uiSegmentSrv.newPlusButton()\n    };\n    this.target.joinQueryList.push(queryObj);\n    console.log(\"addJoin\", this.target.joinQueryList);\n  }\n  delJoin(index) {\n    this.target.joinQueryList.splice(index, 1)\n  }\n\n  getAllFields() {\n    // 获取select的字段，aggregate的字段，以及所有join表中的export字段\n\n    const mainFields = this.getExportOptions(this.target.selectionsParts, this.target.aggParts);\n    console.log(this.target.selectionsParts, '--------');\n    const exportFields = []\n    this.target.joinQueryList.forEach((query) => {\n      console.log(\"fafadsf1\", query.export)\n      query.export.forEach((part) => {\n        console.log(\"fafadsf2\", part);\n        exportFields.push(part.params[1]) // todo: 重复元素保护\n      });\n    });\n    return mainFields.concat(exportFields)\n  }\n\n  getExportOptions(selections, aggs) {\n    // 获取select的字段和aggs的字段并格式化为restSql格式\n    const options = [];\n    selections.forEach((part) => {\n      // export已经select的字段\n      options.push(part[\"params\"][0]);\n    });\n    aggs.forEach((part) => {\n      // export已经aggregation的字段\n      console.log(\"handleJoinExportPartEvent\", part);\n      const [aggFunc, field] = part.params;\n      options.push([field, aggFunc].join(\"__\"));\n    });\n    return options;\n  }\n\n  updateRestSql() {\n    // 将输入的内容更新到target中去\n\n    this.target.query = {\n      // restSql协议结构定义\n      \"select\": {\n        \"from\": \"\",\n        \"fields\": [],\n        \"filter\":{}, \n        \"group_by\": [],\n        \"aggregation\": [],\n        \"sort\": [],\n      },\n      \"join\": [],\n      \"sort\": [],\n      \"fields\": [],\n      \"limit\": 200\n    };\n\n    // udpate table\n    this.target.query.select.from = this.target.table;\n\n    // update select fields\n    this.target.selectionsParts.forEach((part) => {\n      this.target.query.select.fields.push(part.params[0]);\n    });\n\n    // update where\n    const operatorToSuffix = {\n      \"=\": \"\",\n      \"<\": \"__lt\",\n      \"<=\": \"__lte\",\n      \">\": \"__gt\",\n      \">=\": \"__gte\",\n      \"CONTAINS\": \"__contains\",\n      \"STARTSWITH\": \"__startswith\",\n      \"ENDSWITH\": \"__endswith\",\n      \"RANGE\": \"__range\",\n      \"IN\": \"__in\"\n    }\n    // [\"1\", \"=\", \"1\"]\n    this.target.whereParts.forEach((part) => {\n\n      const suffix = operatorToSuffix[part.params[1]];\n      const key = `${part.params[0]}${suffix}`\n      if (part.params[1] === \"IN\") {\n        console.log(\"whereTest\", part.params[2], typeof part.params[2]);\n        this.target.query.select.filter[key] = JSON.parse(part.params[2]);\n       \n      } else {\n        if ((part.params[2].startsWith(\"\\\"\") && part.params[2].endsWith(\"\\\"\")) || (part.params[2].startsWith(\"\\'\") && part.params[2].endsWith(\"\\'\"))) {\n          const tmpStr = part.params[2]\n          this.target.query.select.filter[key] = tmpStr.slice(1, tmpStr.length - 1);\n          // console.log(this.target.query.select);\n        } else if (!isNaN(parseFloat(part.params[2]))) {\n          this.target.query.select.filter[key] = parseFloat(part.params[2]);\n          console.log(this.target.query.select);\n        }\n        else if (part.params[2].toLowerCase() === \"true\" ) {\n          \n          this.target.query.select.filter[key] =true;\n        } else if (part.params[2].toLowerCase() === \"false\") {\n          this.target.query.select.filter[key] = false;\n        }\n        else {\n          return Promise.reject({\n            message: 'tetete',\n          });\n        }\n      }\n    });\n\n    // update aggregation\n    // todo:agg func无法修改, 无法删除\n    this.target.aggParts.forEach((part) => {\n      console.log(\"aggParts\", part);\n      const [aggFunc, field] = part.params;\n      this.target.query.select.aggregation.push([field, aggFunc].join(\"__\"));\n    });\n\n    // update group by\n    this.target.groupParts.forEach((part) => {\n      console.log(\"groupParts\", part);\n      this.target.query.select.group_by.push(part.params[0]);\n    });\n\n    // update join\n    this.target.joinQueryList.forEach((query) => {\n      console.log(\"joinQueryList\", query);\n      const joinQuery = {};\n      // update join type\n      joinQuery.type = query.type;\n      joinQuery.query = { \"select\": {} };\n      console.log(\"joinQueryList\", query);\n      // update join table\n      joinQuery.query.select.from = query.table.value;\n      console.log(\"joinQueryList\", joinQuery.query.select.from);\n      // update join fields\n      joinQuery.query.select.fields = []\n      query.selections.forEach((part) => {\n        console.log(\"selections\", part);\n        joinQuery.query.select.fields.push(part.params[0]);\n      });\n      // udpate join filter\n      joinQuery.query.select.filter = {};\n      query.where.forEach((part) => {\n        const suffix = operatorToSuffix[part.params[1]];\n        const key = `${part.params[0]}${suffix}`;\n\n        if (part.params[1] === \"IN\") {\n          console.log(\"whereTest\", part.params[2], typeof part.params[2]);\n          joinQuery.query.select.filter[key] = JSON.parse(part.params[2]);\n        } else {\n          console.log(\"whereTest\", part.params[2]);\n          if ((part.params[2].startsWith(\"\\\"\") && part.params[2].endsWith(\"\\\"\")) || (part.params[2].startsWith(\"\\'\") && part.params[2].endsWith(\"\\'\"))) {\n            const tmpStr = part.params[2]\n            joinQuery.query.select.filter[key] = tmpStr.slice(1, tmpStr.length - 1);\n          } else if (!isNaN(parseFloat(part.params[2]))) {\n            joinQuery.query.select.filter[key] = parseFloat(part.params[2]);\n          } else {\n            return Promise.reject({\n              message: 'tetete',\n            });\n          }\n\n        }\n\n        console.log(\"joinfilter\", key, joinQuery.query.select.filter);\n      })\n      // update aggregation \n      // todo:agg func无法修改\n      joinQuery.query.select.aggregation = [];\n      query.aggs.forEach((part) => {\n        console.log(\"join_aggregation\", part);\n        const [aggFunc, field] = part.params;\n        joinQuery.query.select.aggregation.push([field, aggFunc].join(\"__\"));\n      });\n      // update join group by\n      joinQuery.query.select.group_by = [];\n      query.groups.forEach((part) => {\n        // console.log(\"join_group\", part);\n        joinQuery.query.select.group_by.push(part.params[0]);\n      });\n      // update join on\n      joinQuery.on = {};\n      query.on.forEach((part) => {\n        joinQuery.on[part.params[0]] = part.params[1];\n      });\n      // updaate export\n      joinQuery.export = [];\n      query.export.forEach((part) => {\n        console.log(\"joinQuery\");\n        joinQuery.export.push(part.params.join(\"@\"));\n      });\n      this.target.query.join.push(joinQuery);\n    });\n\n    // update sort\n    this.target.sortParts.forEach((part) => {\n      console.log(\"sortParts\", part);\n      const sortExp = part.params[0] === \"asc\" ? part.params[1] : `-${part.params[1]}`;\n      this.target.query.sort.push(sortExp);\n    });\n\n    //update fields\n    this.target.fieldParts.forEach((part) => {\n      // console.log(\"fieldParts\", part);\n      this.target.query.fields.push(part.params.join(\"@\"));\n    });\n\n    // update limit\n    this.target.query.limit = parseInt(this.target.limit);\n    // console.log(\"UpdateComplete\", this.target.query);\n    // this.datasource.metricFindQuery(this.target.query || '').then(this.panelCtrl.refresh());\n    // console.log(this.target, this.target.query);\n    this.target.target = JSON.stringify(this.target.query);\n    // this.target.target = this.target.query;\n\n    // console.log(this.target, this.target.query);\n    this.target.whereParts = this.target.whereParts;\n    // console.log(\"UpdateComplete\", this.target.selectionsParts);\n    // this.datasource.metricFindQuery(JSON.stringify(this.target.query) || '');\n    // this.datasource.query(this.target.query);\n    this.panelCtrl.refresh();\n\n  }\n}\nGenericDatasourceQueryCtrl.templateUrl = 'partials/query.editor.html';\n\n"]}