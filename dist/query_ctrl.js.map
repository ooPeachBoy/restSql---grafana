{"version":3,"sources":["../src/query_ctrl.js"],"names":["GenericDatasourceQueryCtrl","$scope","$injector","uiSegmentSrv","$q","scope","lastQueryError","panelCtrl","events","on","PanelEvents","dataReceived","onDataReceived","bind","dataError","onDataError","target","tableSelect","formats","text","value","types","console","log","type","tableSegment","newSegment","table","selectionsParts","selectionsList","forEach","element","__proto__","toLocaleString","express","sqlPart","create","part","push","selectionAdd","newPlusButton","selectMenu","whereParts","whereList","whereAdd","aggParts","aggList","aggAdd","groupParts","groupList","groupAdd","joinQueryList","sortParts","sortList","sortAdd","fieldParts","fieldList","fieldAdd","limitSegment","limit","query","tableName","parth","datasource","metricFindOption","then","result","status","data","tables","rows","segments","_","map","results","segment","expandable","dataList","err","message","options","Promise","resolve","parts","index","indexOf","splice","updateRestSql","joinIndex","getOptions","params","resetPlusButton","event","name","when","action","removePart","item","i","newOperators","expIndex","selections","param","operators","where","aggs","groups","onAdd","export","exportAdd","getExportOptions","getAllFields","button","plusButton","html","queryObj","mainFields","exportFields","concat","aggFunc","field","join","select","from","fields","operatorToSuffix","suffix","key","filter","JSON","parse","startsWith","endsWith","tmpStr","slice","length","isNaN","parseFloat","toLowerCase","reject","aggregation","group_by","joinQuery","sortExp","sort","parseInt","stringify","refresh","QueryCtrl","templateUrl"],"mappings":"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","file":"query_ctrl.js","sourcesContent":["import './css/query-editor.css!'\r\n\r\nimport _ from 'lodash';\r\nimport { QueryCtrl } from 'app/plugins/sdk';\r\nimport sqlPart from './sql_part';\r\nimport { PanelEvents } from '@grafana/data';\r\nimport { MetricsPanelCtrl } from 'app/plugins/sdk';\r\nexport class GenericDatasourceQueryCtrl extends QueryCtrl {\r\n\r\n  constructor($scope, $injector, uiSegmentSrv, $q) {\r\n    super($scope, $injector);\r\n    this.scope = $scope;\r\n    this.uiSegmentSrv = uiSegmentSrv;\r\n    this.$q = $q;\r\n    this.lastQueryError = null;\r\n    this.panelCtrl.events.on(PanelEvents.dataReceived, this.onDataReceived.bind(this), $scope);\r\n    this.panelCtrl.events.on(PanelEvents.dataError, this.onDataError.bind(this), $scope);\r\n\r\n    this.target.tableSelect = this.target.tableSelect || [];\r\n\r\n    this.formats = [\r\n      { text: 'Time series', value: 'grafana.timeserie' },\r\n      { text: 'Table', value: 'grafana.table' },\r\n      \r\n    ];\r\n    this.types = [\r\n      { text: 'Left Join', value: 'left_join' },\r\n      { text: 'Inner Join', value: 'inner_join' },\r\n      { text: 'Full Join', value: 'full_join' }\r\n    ];\r\n\r\n    console.log(this, 11111111111111111111);\r\n\r\n    // this.target.tableSegment = null;\r\n    this.target.target = this.target.target || '';\r\n    this.target.type = this.target.type ||   'grafana.timeserie';\r\n\r\n    this.target.tableSegment = this.uiSegmentSrv.newSegment({ \"value\": this.target.table || 'select table', \"fake\": true });\r\n    this.target.table = this.target.table || this.target.tableSegment.value;\r\n\r\n\r\n\r\n    if (this.target.selectionsParts) {\r\n      let selectionsList = []\r\n      this.target.selectionsParts.forEach(element => {\r\n        if (element.__proto__.toLocaleString) {\r\n          const express = sqlPart.create(element.part)\r\n          selectionsList.push(express);\r\n        }\r\n        this.target.selectionsParts = selectionsList\r\n      });\r\n    } else {\r\n      this.target.selectionsParts = [];\r\n    }\r\n\r\n    this.selectionAdd = this.uiSegmentSrv.newPlusButton();\r\n\r\n    this.selectMenu = [];\r\n    this.selectMenu.push(this.uiSegmentSrv.newSegment({ type: 'expression', value: 'Expression' }));\r\n\r\n\r\n    if (this.target.whereParts) {\r\n      let whereList = []\r\n      this.target.whereParts.forEach(element => {\r\n        if (element.__proto__.toLocaleString) {\r\n          const express = sqlPart.create(element.part)\r\n          whereList.push(express);\r\n        }\r\n        this.target.whereParts = whereList\r\n      });\r\n    } else {\r\n      this.target.whereParts = [];\r\n    }\r\n\r\n    this.whereAdd = this.uiSegmentSrv.newPlusButton();\r\n\r\n\r\n    this.target.aggParts = this.target.aggParts || [];\r\n    if (this.target.aggParts) {\r\n      let aggList = []\r\n      this.target.aggParts.forEach(element => {\r\n        if (element.__proto__.toLocaleString) {\r\n          const express = sqlPart.create(element.part)\r\n          aggList.push(express);\r\n        }\r\n        this.target.aggParts = aggList\r\n      });\r\n    } else {\r\n      this.target.aggParts = [];\r\n    }\r\n    this.aggAdd = this.uiSegmentSrv.newPlusButton();\r\n\r\n    if (this.target.groupParts) {\r\n      let groupList = []\r\n      this.target.groupParts.forEach(element => {\r\n        if (element.__proto__.toLocaleString) {\r\n          const express = sqlPart.create(element.part)\r\n          groupList.push(express);\r\n        }\r\n        this.target.groupParts = groupList\r\n      });\r\n    } else {\r\n      this.target.groupParts = [];\r\n    }\r\n\r\n\r\n    this.groupAdd = this.uiSegmentSrv.newPlusButton();\r\n\r\n    if (this.target.joinQueryList) {\r\n      let joinQueryList = []\r\n      this.target.joinQueryList.forEach(element => {\r\n        if (element.__proto__.toLocaleString) {\r\n          const express = sqlPart.create(element.part)\r\n          joinQueryList.push(express);\r\n        }\r\n        this.target.joinQueryList = joinQueryList\r\n      });\r\n    } else {\r\n      this.target.joinQueryList = [];\r\n    }\r\n\r\n\r\n    if (this.target.sortParts) {\r\n      let sortList = []\r\n      this.target.sortParts.forEach(element => {\r\n        if (element.__proto__.toLocaleString) {\r\n          const express = sqlPart.create(element.part)\r\n          sortList.push(express);\r\n        }\r\n        this.target.sortParts = sortList\r\n      });\r\n    } else {\r\n      this.target.sortParts = [];\r\n    }\r\n\r\n    this.sortAdd = this.uiSegmentSrv.newPlusButton();\r\n\r\n    if (this.target.fieldParts) {\r\n      let fieldList = []\r\n      this.target.fieldParts.forEach(element => {\r\n        if (element.__proto__.toLocaleString) {\r\n          const express = sqlPart.create(element.part)\r\n          fieldList.push(express);\r\n        }\r\n        this.target.fieldParts = fieldList\r\n      });\r\n    } else {\r\n      this.target.fieldParts = [];\r\n    }\r\n\r\n\r\n    this.fieldAdd = this.uiSegmentSrv.newPlusButton();\r\n\r\n    this.target.limitSegment = this.uiSegmentSrv.newSegment({ \"value\": this.target.limit || '1000', \"fake\": true });\r\n    this.target.limit = this.target.limitSegment.value || '1000';\r\n    this.target.query = {\r\n      // restSql协议结构定义\r\n      \"select\": {\r\n        \"from\": \"\",\r\n        \"filter\": {},\r\n        \"group_by\": [],\r\n        \"aggregation\": [],\r\n        \"sort\": [],\r\n      },\r\n      \"join\": [],\r\n      \"sort\": [],\r\n      \"fields\": [],\r\n      \"limit\": 200\r\n    };\r\n\r\n  }\r\n  getTableSegments() {\r\n    let tableName = this.target.table;\r\n    let parth = 'getList';\r\n    this.datasource.metricFindOption(tableName, parth).then(result => {\r\n      if (result.status === 200) {\r\n        this.target.tableSelect = result.data.data.tables[0].rows;\r\n      }\r\n    })\r\n\r\n  }\r\n  transformToSegments() {\r\n    return (result) => {\r\n      const segments = _.map(results, segment => {\r\n        return this.uiSegmentSrv.newSegment({\r\n          value: segment.text,\r\n          expandable: segment.expandable,\r\n        });\r\n      });\r\n      return segments;\r\n    }\r\n  }\r\n\r\n  onDataReceived(dataList) {\r\n    console.log(dataList);\r\n    this.lastQueryError = null\r\n  }\r\n  onDataError(err) {\r\n    if (this.target.target) {\r\n      this.lastQueryError = err.message\r\n    }\r\n\r\n  }\r\n\r\n  getOptions() {\r\n    const options = [];\r\n    options.push(this.uiSegmentSrv.newSegment({ type: 'expression', value: 'Expression' }));\r\n    console.log(\"tttttt getOptions\", options);\r\n    return Promise.resolve(options);\r\n  }\r\n\r\n  removePart(parts, part) {\r\n    const index = _.indexOf(parts, part);\r\n    parts.splice(index, 1);\r\n  }\r\n\r\n  onFormatChanged() {\r\n    console.log(\"onFormatChanged\", this);\r\n    this.updateRestSql();\r\n  }\r\n\r\n  onTableChanged() {\r\n    console.log(\"tableChanged\", this);\r\n    this.target.table = this.target.tableSegment.value;\r\n    this.updateRestSql();\r\n  }\r\n\r\n  onJoinTableChanged(joinIndex) {\r\n    console.log(\"onJoinTableChanged\", joinIndex);\r\n    // this.target.joinQueryList[joinIndex].table = ;\r\n    this.updateRestSql();\r\n  }\r\n\r\n  onLimitChanged() {\r\n    // console.log(\"onLimitChanged\");\r\n    this.target.limit = this.target.limitSegment.value;\r\n    this.updateRestSql();\r\n  }\r\n\r\n  addSelectionAction(part, index) {\r\n    console.log(1111, part, index);\r\n    this.getOptions()\r\n    const express = sqlPart.create({ type: 'column', params: ['column'] });\r\n    this.target.selectionsParts.push(express);\r\n    this.resetPlusButton(this.selectionAdd);\r\n\r\n  }\r\n\r\n  handleSelectionsPartEvent(part, index, event) {\r\n    console.log(\"tttttt handleSelectionsPartEvent\", event, index, part, '---');\r\n    // if (event.name = \"get-param-options\")\r\n    if (event.name === \"get-part-actions\") {\r\n      return this.$q.when([{ text: 'Remove', value: 'remove' }]);\r\n\r\n    } else if (event.name === \"action\" && event.action.value === \"remove\") {\r\n      this.removePart(this.target.selectionsParts, part);\r\n      // this.target.selectionsParts.splice(index, 1, null);\r\n      this.updateRestSql()\r\n      console.log(this.target.selectionsParts, '------')\r\n    } else if (event.name === \"part-param-changed\") {\r\n      console.log(this.target.selectionsParts);\r\n      this.target.selectionsParts.forEach((item, i) => {\r\n      })\r\n      this.updateRestSql();\r\n    } else if (event.name === \"get-param-options\") {\r\n      return Promise.resolve(this.uiSegmentSrv.newOperators(this.target.tableSelect));\r\n    }\r\n  }\r\n\r\n  addJoinSelectionAction(joinIndex, expIndex) {\r\n    console.log(\"addJoinSelectionAction\", joinIndex, expIndex);\r\n    const express = sqlPart.create({ type: 'column', params: ['column'] });\r\n    this.target.joinQueryList[joinIndex].selections.push(express)\r\n    this.resetPlusButton(this.target.joinQueryList[joinIndex].selectionAdd);\r\n  }\r\n\r\n  handleJoinSelectionsPartEvent(part, joinIndex, expIndex, event) {\r\n    console.log(\"handleJoinSelectionsPartEvent\", joinIndex, expIndex);\r\n    if (event.name === \"get-part-actions\") {\r\n      return this.$q.when([{ text: 'Remove', value: 'remove' }]);\r\n    } else if (event.name === \"action\" && event.action.value === \"remove\") {\r\n      // this.removePart(this.target.joinQueryList[joinIndex].selections, part);\r\n      this.target.joinQueryList[joinIndex].selections.splice(expIndex, 1);\r\n      this.updateRestSql()\r\n    } else if (event.name === \"part-param-changed\") {\r\n      this.updateRestSql();\r\n    }\r\n  }\r\n\r\n  addWhereAction(part, index) {\r\n    const express = sqlPart.create({ type: 'expression', params: ['column', '=', 'value'] });\r\n\r\n    this.target.whereParts.push(express);\r\n\r\n    this.resetPlusButton(this.whereAdd);\r\n  }\r\n\r\n  handleWherePartEvent(part, index, event) {\r\n    // console.log(\"handleWherePartEvent\", event);\r\n    if (event.name === \"get-param-options\" && event.param.name === \"op\") {\r\n      // 暂时只支持展开操作符列表\r\n      const operators = ['=', '<', '<=', '>', '>=', 'CONTAINS', 'STARTSWITH', 'ENDSWITH', 'RANGE', 'IN'];\r\n      return Promise.resolve(this.uiSegmentSrv.newOperators(operators));\r\n    } else if (event.name === \"get-part-actions\") {\r\n      return this.$q.when([{ text: 'Remove', value: 'remove' }]);\r\n    } else if (event.name === \"action\" && event.action.value === \"remove\") {\r\n      this.target.whereParts.splice(index, 1);\r\n      this.updateRestSql()\r\n    } else if (event.name === \"part-param-changed\") {\r\n      this.updateRestSql();\r\n    } else {\r\n      return Promise.resolve([]);\r\n    }\r\n  }\r\n\r\n  addJoinWhereAction(joinIndex, expIndex) {\r\n    const express = sqlPart.create({ type: 'expression', params: ['column', '=', 'value'] });\r\n    console.log(\"addWhereAction\", express);\r\n    this.target.joinQueryList[joinIndex].where.push(express);\r\n    this.resetPlusButton(this.target.joinQueryList[joinIndex].whereAdd);\r\n  }\r\n\r\n  handleJoinWherePartEvent(part, joinIndex, expIndex, event) {\r\n    console.log(\"handleJoinWherePartEvent\", event);\r\n    if (event.name === \"get-param-options\" && event.param.name === \"op\") {\r\n      // 暂时只支持展开操作符列表\r\n      const operators = ['=', '<', '<=', '>', '>=', 'CONTAINS', 'STARTSWITH', 'ENDSWITH', 'RANGE', 'IN'];\r\n      return Promise.resolve(this.uiSegmentSrv.newOperators(operators));\r\n    } else if (event.name === \"get-part-actions\") {\r\n      return this.$q.when([{ text: 'Remove', value: 'remove' }]);\r\n    } else if (event.name === \"action\" && event.action.value === \"remove\") {\r\n      this.target.joinQueryList[joinIndex].where.splice(expIndex, 1);\r\n    } else if (event.name === \"part-param-changed\") {\r\n      this.updateRestSql();\r\n    } else {\r\n      return Promise.resolve([]);\r\n    }\r\n  }\r\n\r\n  addAggAction() {\r\n    const express = sqlPart.create({ type: 'aggregate', params: ['avg', 'column'] });\r\n    console.log(\"addAggAction\", express);\r\n    this.target.aggParts.push(express);\r\n    this.resetPlusButton(this.aggAdd);\r\n  }\r\n\r\n  handleAggPartEvent(part, index, event) {\r\n    console.log(\"handleAggPartEvent\", event, part, index);\r\n    if (event.name === \"get-param-options\" && event.param.name === \"agg\") {\r\n      // 暂时只支持展开操作符列表\r\n      const operators = event.param.options;\r\n      return Promise.resolve(this.uiSegmentSrv.newOperators(operators));\r\n    } else if (event.name === \"get-part-actions\") {\r\n      return this.$q.when([{ text: 'Remove', value: 'remove' }]);\r\n    } else if (event.name === \"action\" && event.action.value === \"remove\") {\r\n      this.target.aggParts.splice(index, 1)\r\n      this.updateRestSql()\r\n    } else if (event.name === \"part-param-changed\") {\r\n      this.updateRestSql();\r\n    } else {\r\n      return Promise.resolve([]);\r\n    }\r\n  }\r\n\r\n  addJoinAggAction(joinIndex) {\r\n    const express = sqlPart.create({ type: 'aggregate', params: ['avg', 'column'] });\r\n    console.log(\"addJoinAggAction\", express);\r\n    this.target.joinQueryList[joinIndex].aggs.push(express);\r\n    this.resetPlusButton(this.target.joinQueryList[joinIndex].aggAdd);\r\n  }\r\n\r\n  handleJoinAggPartEvent(part, joinIndex, expIndex, event) {\r\n    console.log(\"handleJoinAggPartEvent\", event);\r\n    if (event.name === \"get-param-options\" && event.param.name === \"agg\") {\r\n      // 暂时只支持展开操作符列表\r\n      const operators = event.param.options;\r\n      return Promise.resolve(this.uiSegmentSrv.newOperators(operators));\r\n    } else if (event.name === \"get-part-actions\") {\r\n      return this.$q.when([{ text: 'Remove', value: 'remove' }]);\r\n    } else if (event.name === \"action\" && event.action.value === \"remove\") {\r\n      this.target.joinQueryList[joinIndex].aggs.splice(expIndex, 1);\r\n      this.updateRestSql()\r\n    } else if (event.name === \"part-param-changed\") {\r\n      this.updateRestSql();\r\n    } else {\r\n      return Promise.resolve([]);\r\n    }\r\n  }\r\n\r\n  addGroupAction() {\r\n    const express = sqlPart.create({ type: 'column', params: ['column'] });\r\n    console.log(\"addGroupsAction\", express);\r\n    this.target.groupParts.push(express);\r\n    this.resetPlusButton(this.groupAdd);\r\n  }\r\n\r\n  handleGroupPartEvent(part, index, event) {\r\n    console.log(\"handleGroupsPartEvent\");\r\n    if (event.name === \"get-part-actions\") {\r\n      return this.$q.when([{ text: 'Remove', value: 'remove' }]);\r\n    } else if (event.name === \"action\" && event.action.value === \"remove\") {\r\n      this.target.groupParts.splice(index, 1);\r\n      this.updateRestSql()\r\n    } else if (event.name === \"part-param-changed\") {\r\n      this.updateRestSql();\r\n    }\r\n  }\r\n\r\n  addJoinGroupAction(part, joinIndex, expIndex) {\r\n    const express = sqlPart.create({ type: 'column', params: ['column'] });\r\n    console.log(\"addGroupsAction\", express);\r\n    this.target.joinQueryList[joinIndex].groups.push(express);\r\n    this.resetPlusButton(this.target.joinQueryList[joinIndex].groupAdd);\r\n  }\r\n\r\n  handleJoinGroupPartEvent(part, joinIndex, expIndex, event) {\r\n    console.log(\"handleJoinGroupPartEvent\");\r\n    if (event.name === \"get-part-actions\") {\r\n      return this.$q.when([{ text: 'Remove', value: 'remove' }]);\r\n    } else if (event.name === \"action\" && event.action.value === \"remove\") {\r\n      this.target.joinQueryList[joinIndex].groups.splice(expIndex, 1);\r\n      this.updateRestSql();\r\n    } else if (event.name === \"part-param-changed\") {\r\n      this.updateRestSql();\r\n    }\r\n  }\r\n\r\n  addJoinOnAction(part, joinIndex, expIndex) {\r\n    const express = sqlPart.create({ type: 'on', params: ['field', 'field'] });\r\n    console.log(\"addJoinOnAction\", express);\r\n    this.target.joinQueryList[joinIndex].on.push(express);\r\n    this.resetPlusButton(this.target.joinQueryList[joinIndex].onAdd);\r\n  }\r\n\r\n  handleJoinOnPartEvent(part, joinIndex, expIndex, event) {\r\n    console.log(\"handleJoinOnPartEvent\", event);\r\n    if (event.name === \"get-param-options\" && event.param.name === \"op\") {\r\n      // 暂时只支持展开操作符列表\r\n      const operators = ['='];\r\n      return Promise.resolve(this.uiSegmentSrv.newOperators(operators));\r\n    } else if (event.name === \"get-part-actions\") {\r\n      return this.$q.when([{ text: 'Remove', value: 'remove' }]);\r\n    } else if (event.name === \"action\" && event.action.value === \"remove\") {\r\n      this.target.joinQueryList[joinIndex].on.splice(expIndex, 1);\r\n    } else if (event.name === \"get-param-options\" && event.param.name === \"field1\") {\r\n      // on field1=field2，field1是join的表中的字段，field2是原始表中的字段，这里做成可选项\r\n      console.log(\"handleJoinOnPartEvent\", this.target.joinQueryList[joinIndex]);\r\n      const options = [];\r\n      this.target.joinQueryList[joinIndex].selections.forEach((part) => {\r\n        options.push(part[\"params\"][0]);\r\n      });\r\n      return Promise.resolve(this.uiSegmentSrv.newOperators(options));\r\n    } else if (event.name === \"get-param-options\" && event.param.name === \"field2\") {\r\n      const options = [];\r\n      this.target.selectionsParts.forEach((part) => {\r\n        options.push(part[\"params\"][0]);\r\n      });\r\n      return Promise.resolve(this.uiSegmentSrv.newOperators(options));\r\n    } else if (event.name === \"part-param-changed\") {\r\n      this.updateRestSql();\r\n    } else {\r\n      return Promise.resolve([]);\r\n    }\r\n  }\r\n\r\n  addJoinExportAction(part, joinIndex, expIndex) {\r\n    const express = sqlPart.create({ type: 'alias', params: ['fields', 'alias'] });\r\n    console.log(\"addJoinOnAction\", express);\r\n    this.target.joinQueryList[joinIndex].export.push(express);\r\n    this.resetPlusButton(this.target.joinQueryList[joinIndex].exportAdd);\r\n  }\r\n\r\n  handleJoinExportPartEvent(part, joinIndex, expIndex, event) {\r\n    console.log(\"handleJoinExportPartEvent\", event);\r\n    if (event.name === \"get-part-actions\") {\r\n      return this.$q.when([{ text: 'Remove', value: 'remove' }]);\r\n    } else if (event.name === \"action\" && event.action.value === \"remove\") {\r\n      this.target.joinQueryList[joinIndex].export.splice(expIndex, 1);\r\n      this.updateRestSql();\r\n    } else if (event.name === \"get-param-options\" && event.param.name === \"field\") {\r\n      const options = this.getExportOptions(this.target.joinQueryList[joinIndex].selections, this.target.joinQueryList[joinIndex].aggs);\r\n      return Promise.resolve(this.uiSegmentSrv.newOperators(options));\r\n    } else if (event.name === \"part-param-changed\") {\r\n      this.updateRestSql();\r\n    } else {\r\n      return Promise.resolve([]);\r\n    }\r\n  }\r\n\r\n  addSortAction(index) {\r\n    const express = sqlPart.create({ type: 'sort', params: ['asc', 'field'] });\r\n    console.log(\"addSortAction\", index);\r\n    this.target.sortParts.push(express);\r\n    this.resetPlusButton(this.sortAdd);\r\n  }\r\n\r\n  handleSortPartEvent(part, index, event) {\r\n    console.log(\"handleSortPartEvent\", event);\r\n    if (event.name === \"get-part-actions\") {\r\n      return this.$q.when([{ text: 'Remove', value: 'remove' }]);\r\n    } else if (event.name === \"action\" && event.action.value === \"remove\") {\r\n      // console.log(this.target.sortParts,'====');\r\n\r\n      this.target.sortParts.splice(index, 1);\r\n      this.updateRestSql();\r\n      // console.log(this.target.sortParts,'====');\r\n    } else if (event.name === \"get-param-options\" && event.param.name === \"field\") {\r\n      return Promise.resolve(this.uiSegmentSrv.newOperators(this.getAllFields()));\r\n    } else if (event.name === \"part-param-changed\") {\r\n      this.updateRestSql();\r\n    } else {\r\n      return Promise.resolve([]);\r\n    }\r\n  }\r\n\r\n  addFieldAction(index) {\r\n    const express = sqlPart.create({ type: 'alias', params: ['fields', 'alias'] });\r\n    console.log(\"addSortAction\", index, express);\r\n    this.target.fieldParts.push(express);\r\n    this.resetPlusButton(this.fieldAdd);\r\n  }\r\n\r\n  handleFieldPartEvent(part, index, event) {\r\n    // console.log(\"handleFieldPartEvent\", event);\r\n    if (event.name === \"get-part-actions\") {\r\n      return this.$q.when([{ text: 'Remove', value: 'remove' }]);\r\n    } else if (event.name === \"action\" && event.action.value === \"remove\") {\r\n\r\n      this.target.fieldParts.splice(index, 1);\r\n      this.updateRestSql();\r\n\r\n    } else if (event.name === \"get-param-options\") {\r\n      return Promise.resolve(this.uiSegmentSrv.newOperators(this.getAllFields()));\r\n    } else if (event.name === \"part-param-changed\") {\r\n      this.updateRestSql();\r\n    } else {\r\n      return Promise.resolve([]);\r\n    }\r\n  }\r\n\r\n  resetPlusButton(button) {\r\n    const plusButton = this.uiSegmentSrv.newPlusButton();\r\n    button.html = plusButton.html;\r\n    button.value = plusButton.value;\r\n  }\r\n\r\n  addJoin() {\r\n    const queryObj = {\r\n      type: \"left_join\",\r\n      table: this.uiSegmentSrv.newSegment({ \"value\": \"select table\", \"fake\": true }),\r\n      selections: [],\r\n      selectionAdd: this.uiSegmentSrv.newPlusButton(),\r\n      where: [],\r\n      whereAdd: this.uiSegmentSrv.newPlusButton(),\r\n      aggs: [],\r\n      aggAdd: this.uiSegmentSrv.newPlusButton(),\r\n      groups: [],\r\n      groupAdd: this.uiSegmentSrv.newPlusButton(),\r\n      on: [],\r\n      onAdd: this.uiSegmentSrv.newPlusButton(),\r\n      export: [],\r\n      exportAdd: this.uiSegmentSrv.newPlusButton()\r\n    };\r\n    this.target.joinQueryList.push(queryObj);\r\n    console.log(\"addJoin\", this.target.joinQueryList);\r\n  }\r\n  delJoin(index) {\r\n    this.target.joinQueryList.splice(index, 1)\r\n  }\r\n\r\n  getAllFields() {\r\n    // 获取select的字段，aggregate的字段，以及所有join表中的export字段\r\n\r\n    const mainFields = this.getExportOptions(this.target.selectionsParts, this.target.aggParts);\r\n    const exportFields = []\r\n    this.target.joinQueryList.forEach((query) => {\r\n      console.log(\"fafadsf1\", query.export)\r\n      query.export.forEach((part) => {\r\n        console.log(\"fafadsf2\", part);\r\n        exportFields.push(part.params[1]) // todo: 重复元素保护\r\n      });\r\n    });\r\n    return mainFields.concat(exportFields)\r\n  }\r\n\r\n  getExportOptions(selections, aggs) {\r\n    // 获取select的字段和aggs的字段并格式化为restSql格式\r\n    const options = [];\r\n    selections.forEach((part) => {\r\n      // export已经select的字段\r\n      options.push(part[\"params\"][0]);\r\n    });\r\n    aggs.forEach((part) => {\r\n      // export已经aggregation的字段\r\n      console.log(\"handleJoinExportPartEvent\", part);\r\n      const [aggFunc, field] = part.params;\r\n      options.push([field, aggFunc].join(\"__\"));\r\n    });\r\n    return options;\r\n  }\r\n\r\n  updateRestSql() {\r\n    // 将输入的内容更新到target中去\r\n\r\n\r\n    this.target.query = {\r\n      // restSql协议结构定义\r\n      \"select\": {\r\n        \"from\": \"\",\r\n        \"fields\": [],\r\n        \"filter\": {},\r\n        \"group_by\": [],\r\n        \"aggregation\": [],\r\n        \"sort\": [],\r\n      },\r\n      \"join\": [],\r\n      \"sort\": [],\r\n      \"fields\": [],\r\n      \"limit\": 200\r\n    };\r\n\r\n    // udpate table\r\n    this.target.query.select.from = this.target.table;\r\n\r\n    // update select fields\r\n    this.target.selectionsParts.forEach((part) => {\r\n      this.target.query.select.fields.push(part.params[0]);\r\n    });\r\n\r\n    // update where\r\n    const operatorToSuffix = {\r\n      \"=\": \"\",\r\n      \"<\": \"__lt\",\r\n      \"<=\": \"__lte\",\r\n      \">\": \"__gt\",\r\n      \">=\": \"__gte\",\r\n      \"CONTAINS\": \"__contains\",\r\n      \"STARTSWITH\": \"__startswith\",\r\n      \"ENDSWITH\": \"__endswith\",\r\n      \"RANGE\": \"__range\",\r\n      \"IN\": \"__in\"\r\n    }\r\n    // [\"1\", \"=\", \"1\"]\r\n    this.target.whereParts.forEach((part) => {\r\n\r\n      const suffix = operatorToSuffix[part.params[1]];\r\n      const key = `${part.params[0]}${suffix}`\r\n      if (part.params[1] === \"IN\") {\r\n        console.log(\"whereTest\", part.params[2], typeof part.params[2]);\r\n        this.target.query.select.filter[key] = JSON.parse(part.params[2]);\r\n\r\n      } else {\r\n        if ((part.params[2].startsWith(\"\\\"\") && part.params[2].endsWith(\"\\\"\")) || (part.params[2].startsWith(\"\\'\") && part.params[2].endsWith(\"\\'\"))) {\r\n          const tmpStr = part.params[2]\r\n          this.target.query.select.filter[key] = tmpStr.slice(1, tmpStr.length - 1);\r\n          // console.log(this.target.query.select);\r\n        } else if (!isNaN(parseFloat(part.params[2]))) {\r\n          this.target.query.select.filter[key] = parseFloat(part.params[2]);\r\n          console.log(this.target.query.select);\r\n        }\r\n        else if (part.params[2].toLowerCase() === \"true\") {\r\n          this.target.query.select.filter[key] = true;\r\n        } else if (part.params[2].toLowerCase() === \"false\") {\r\n          this.target.query.select.filter[key] = false;\r\n        }\r\n        else {\r\n          return Promise.reject({\r\n            message: 'tetete',\r\n          });\r\n        }\r\n      }\r\n    });\r\n\r\n    // update aggregation\r\n    // todo:agg func无法修改, 无法删除\r\n    this.target.aggParts.forEach((part) => {\r\n      console.log(\"aggParts\", part);\r\n      const [aggFunc, field] = part.params;\r\n      this.target.query.select.aggregation.push([field, aggFunc].join(\"__\"));\r\n    });\r\n\r\n    // update group by\r\n    this.target.groupParts.forEach((part) => {\r\n      console.log(\"groupParts\", part);\r\n      this.target.query.select.group_by.push(part.params[0]);\r\n    });\r\n\r\n    // update join\r\n    this.target.joinQueryList.forEach((query) => {\r\n      console.log(\"joinQueryList\", query);\r\n      const joinQuery = {};\r\n      // update join type\r\n      joinQuery.type = query.type;\r\n      joinQuery.query = { \"select\": {} };\r\n      console.log(\"joinQueryList\", query);\r\n      // update join table\r\n      joinQuery.query.select.from = query.table.value;\r\n      console.log(\"joinQueryList\", joinQuery.query.select.from);\r\n      // update join fields\r\n      joinQuery.query.select.fields = []\r\n      query.selections.forEach((part) => {\r\n        console.log(\"selections\", part);\r\n        joinQuery.query.select.fields.push(part.params[0]);\r\n      });\r\n      // udpate join filter\r\n      joinQuery.query.select.filter = {};\r\n      query.where.forEach((part) => {\r\n        const suffix = operatorToSuffix[part.params[1]];\r\n        const key = `${part.params[0]}${suffix}`;\r\n\r\n        if (part.params[1] === \"IN\") {\r\n          console.log(\"whereTest\", part.params[2], typeof part.params[2]);\r\n          joinQuery.query.select.filter[key] = JSON.parse(part.params[2]);\r\n        } else {\r\n          console.log(\"whereTest\", part.params[2]);\r\n          if ((part.params[2].startsWith(\"\\\"\") && part.params[2].endsWith(\"\\\"\")) || (part.params[2].startsWith(\"\\'\") && part.params[2].endsWith(\"\\'\"))) {\r\n            const tmpStr = part.params[2]\r\n            joinQuery.query.select.filter[key] = tmpStr.slice(1, tmpStr.length - 1);\r\n          } else if (!isNaN(parseFloat(part.params[2]))) {\r\n            joinQuery.query.select.filter[key] = parseFloat(part.params[2]);\r\n          } else {\r\n            return Promise.reject({\r\n              message: 'tetete',\r\n            });\r\n          }\r\n\r\n        }\r\n\r\n        console.log(\"joinfilter\", key, joinQuery.query.select.filter);\r\n      })\r\n      // update aggregation \r\n      // todo:agg func无法修改\r\n      joinQuery.query.select.aggregation = [];\r\n      query.aggs.forEach((part) => {\r\n        console.log(\"join_aggregation\", part);\r\n        const [aggFunc, field] = part.params;\r\n        joinQuery.query.select.aggregation.push([field, aggFunc].join(\"__\"));\r\n      });\r\n      // update join group by\r\n      joinQuery.query.select.group_by = [];\r\n      query.groups.forEach((part) => {\r\n        // console.log(\"join_group\", part);\r\n        joinQuery.query.select.group_by.push(part.params[0]);\r\n      });\r\n      // update join on\r\n      joinQuery.on = {};\r\n      query.on.forEach((part) => {\r\n        joinQuery.on[part.params[0]] = part.params[1];\r\n      });\r\n      // updaate export\r\n      joinQuery.export = [];\r\n      query.export.forEach((part) => {\r\n        console.log(\"joinQuery\");\r\n        joinQuery.export.push(part.params.join(\"@\"));\r\n      });\r\n      this.target.query.join.push(joinQuery);\r\n    });\r\n\r\n    // update sort\r\n    this.target.sortParts.forEach((part) => {\r\n      console.log(\"sortParts\", part);\r\n      const sortExp = part.params[0] === \"asc\" ? part.params[1] : `-${part.params[1]}`;\r\n      this.target.query.sort.push(sortExp);\r\n    });\r\n\r\n    //update fields\r\n    this.target.fieldParts.forEach((part) => {\r\n      console.log(\"fieldParts\", part.params[0], '5555555555');\r\n      this.target.query.fields.push(part.params.join(\"@\"));\r\n    });\r\n\r\n    // update limit\r\n    this.target.query.limit = parseInt(this.target.limit);\r\n    // console.log(\"UpdateComplete\", this.target.query);\r\n    // this.datasource.metricFindQuery(this.target.query || '').then(this.panelCtrl.refresh());\r\n    // console.log(this.target, this.target.query);\r\n    this.target.target = JSON.stringify(this.target.query);\r\n    // this.target.target = this.target.query;\r\n\r\n    // console.log(this.target, this.target.query);\r\n    this.target.whereParts = this.target.whereParts;\r\n    // console.log(\"UpdateComplete\", this.target.selectionsParts);\r\n    // this.datasource.metricFindQuery(JSON.stringify(this.target.query) || '');\r\n    // this.datasource.query(this.target.query);\r\n    this.panelCtrl.refresh();\r\n\r\n  }\r\n}\r\nGenericDatasourceQueryCtrl.templateUrl = 'partials/query.editor.html';\r\n\r\n"]}